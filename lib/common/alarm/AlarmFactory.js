"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AlarmFactory = exports.CompositeAlarmOperator = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const aws_cloudwatch_1 = require("aws-cdk-lib/aws-cloudwatch");
const action_1 = require("./action");
const AlarmNamingStrategy_1 = require("./AlarmNamingStrategy");
const IAlarmAnnotationStrategy_1 = require("./IAlarmAnnotationStrategy");
const metric_adjuster_1 = require("./metric-adjuster");
const metric_1 = require("../metric");
const DefaultDatapointsToAlarm = 3;
var CompositeAlarmOperator;
(function (CompositeAlarmOperator) {
    /**
     * trigger only if all the alarms are triggered
     */
    CompositeAlarmOperator[CompositeAlarmOperator["AND"] = 0] = "AND";
    /**
     * trigger if any of the alarms is triggered
     */
    CompositeAlarmOperator[CompositeAlarmOperator["OR"] = 1] = "OR";
})(CompositeAlarmOperator = exports.CompositeAlarmOperator || (exports.CompositeAlarmOperator = {}));
class AlarmFactory {
    constructor(alarmScope, props) {
        this.alarmScope = alarmScope;
        this.globalAlarmDefaults = props.globalAlarmDefaults;
        this.globalMetricDefaults = props.globalMetricDefaults;
        this.alarmNamingStrategy =
            props.globalAlarmDefaults.alarmNamingStrategy ??
                new AlarmNamingStrategy_1.AlarmNamingStrategy(props.globalAlarmDefaults.alarmNamePrefix, props.localAlarmNamePrefix, props.globalAlarmDefaults.dedupeStringProcessor);
    }
    addAlarm(metric, props) {
        // adjust the metric
        const metricAdjuster = props.metricAdjuster
            ? metric_adjuster_1.CompositeMetricAdjuster.of(props.metricAdjuster, metric_adjuster_1.DefaultMetricAdjuster.INSTANCE)
            : metric_adjuster_1.DefaultMetricAdjuster.INSTANCE;
        const adjustedMetric = metricAdjuster.adjustMetric(metric, this.alarmScope, props);
        // metric that will be ultimately used to create the alarm
        let alarmMetric = adjustedMetric;
        // prepare primary alarm properties
        const actionsEnabled = this.determineActionsEnabled(props.actionsEnabled, props.disambiguator);
        const action = this.determineAction(props.disambiguator, props.actionOverride);
        const alarmName = this.alarmNamingStrategy.getName(props);
        const alarmNameSuffix = props.alarmNameSuffix;
        const alarmLabel = this.alarmNamingStrategy.getWidgetLabel(props);
        const alarmDescription = this.generateDescription(props.alarmDescription, props.alarmDescriptionOverride, props.runbookLink, props.documentationLink);
        const dedupeString = this.alarmNamingStrategy.getDedupeString(props);
        const evaluateLowSampleCountPercentile = props.evaluateLowSampleCountPercentile ?? true;
        const datapointsToAlarm = props.datapointsToAlarm ??
            this.globalAlarmDefaults.datapointsToAlarm ??
            DefaultDatapointsToAlarm;
        const evaluationPeriods = props.evaluationPeriods ??
            this.globalAlarmDefaults.evaluationPeriods ??
            datapointsToAlarm;
        if (evaluationPeriods < datapointsToAlarm) {
            throw new Error(`evaluationPeriods must be greater than or equal to datapointsToAlarm for ${alarmName}`);
        }
        // apply metric math for minimum metric samples
        if (props.minSampleCountToEvaluateDatapoint) {
            let label = `${adjustedMetric}`;
            let metricExpression;
            let metricSampleCountId = "sampleCount";
            let usingMetrics;
            if (adjustedMetric instanceof aws_cloudwatch_1.MathExpression) {
                label = adjustedMetric.label ?? label;
                metricExpression = `(${adjustedMetric.expression})`;
                if (Object.keys(adjustedMetric.usingMetrics).length === 1) {
                    const sampleCountMetric = adjustedMetric.usingMetrics[Object.keys(adjustedMetric.usingMetrics)[0]].with({
                        statistic: metric_1.MetricStatistic.N,
                        label: "Sample count",
                    });
                    usingMetrics = {
                        ...adjustedMetric.usingMetrics,
                        [metricSampleCountId]: sampleCountMetric,
                    };
                }
                else if (props.sampleCountMetricId) {
                    usingMetrics = adjustedMetric.usingMetrics;
                    metricSampleCountId = props.sampleCountMetricId;
                }
                else {
                    throw new Error("sampleCountMetricId must be specified when using minSampleCountToEvaluateDatapoint with a multiple-metric MathExpression");
                }
            }
            else {
                const metricId = "metric";
                metricExpression = metricId;
                usingMetrics = {
                    [metricId]: adjustedMetric,
                    [metricSampleCountId]: adjustedMetric.with({
                        statistic: metric_1.MetricStatistic.N,
                        label: "Sample count",
                    }),
                };
            }
            alarmMetric = new aws_cloudwatch_1.MathExpression({
                label,
                expression: `IF(${metricSampleCountId} > ${props.minSampleCountToEvaluateDatapoint}, ${metricExpression})`,
                period: adjustedMetric.period,
                usingMetrics,
            });
        }
        // create primary alarm
        const primaryAlarm = alarmMetric.createAlarm(this.alarmScope, alarmName, {
            alarmName,
            alarmDescription,
            threshold: props.threshold,
            comparisonOperator: props.comparisonOperator,
            treatMissingData: props.treatMissingData,
            // default value (undefined) means "evaluate"
            evaluateLowSampleCountPercentile: evaluateLowSampleCountPercentile
                ? undefined
                : "ignore",
            datapointsToAlarm,
            evaluationPeriods,
            actionsEnabled,
        });
        let alarm = primaryAlarm;
        // create composite alarm for min metric samples (if defined)
        // deprecated in favour of minSampleCountToEvaluateDatapoint
        if (!props.minSampleCountToEvaluateDatapoint &&
            props.minMetricSamplesToAlarm) {
            const metricSampleCount = adjustedMetric.with({
                statistic: metric_1.MetricStatistic.N,
            });
            const noSamplesAlarm = metricSampleCount.createAlarm(this.alarmScope, `${alarmName}-NoSamples`, {
                alarmName: `${alarmName}-NoSamples`,
                alarmDescription: `The metric (${adjustedMetric}) does not have enough samples to alarm. Must have at least ${props.minMetricSamplesToAlarm}.`,
                threshold: props.minMetricSamplesToAlarm,
                comparisonOperator: aws_cloudwatch_1.ComparisonOperator.LESS_THAN_THRESHOLD,
                treatMissingData: aws_cloudwatch_1.TreatMissingData.BREACHING,
                datapointsToAlarm: 1,
                evaluationPeriods: 1,
                actionsEnabled,
            });
            alarm = new aws_cloudwatch_1.CompositeAlarm(this.alarmScope, `${alarmName}-WithSamples`, {
                actionsEnabled,
                compositeAlarmName: `${alarmName}-WithSamples`,
                alarmDescription: this.joinDescriptionParts(alarmDescription, `Min number of samples to alarm: ${props.minMetricSamplesToAlarm}`),
                alarmRule: aws_cloudwatch_1.AlarmRule.allOf(aws_cloudwatch_1.AlarmRule.fromAlarm(primaryAlarm, aws_cloudwatch_1.AlarmState.ALARM), aws_cloudwatch_1.AlarmRule.not(aws_cloudwatch_1.AlarmRule.fromAlarm(noSamplesAlarm, aws_cloudwatch_1.AlarmState.ALARM))),
            });
        }
        // attach alarm actions
        action.addAlarmActions({
            alarm,
            action,
            dedupeString,
            disambiguator: props.disambiguator,
            customTags: props.customTags ?? [],
            customParams: props.customParams ?? {},
        });
        // create annotation for the primary alarm
        const annotation = this.createAnnotation({
            alarm: primaryAlarm,
            action,
            metric: adjustedMetric,
            evaluationPeriods,
            datapointsToAlarm,
            dedupeString,
            minMetricSamplesToAlarm: props.minMetricSamplesToAlarm,
            minSampleCountToEvaluateDatapoint: props.minSampleCountToEvaluateDatapoint,
            fillAlarmRange: props.fillAlarmRange ?? false,
            overrideAnnotationColor: props.overrideAnnotationColor,
            overrideAnnotationLabel: props.overrideAnnotationLabel,
            overrideAnnotationVisibility: props.overrideAnnotationVisibility,
            comparisonOperator: props.comparisonOperator,
            threshold: props.threshold,
            disambiguator: props.disambiguator,
            customTags: props.customTags ?? [],
            customParams: props.customParams ?? {},
        });
        // return the final result
        return {
            alarm,
            action,
            alarmName,
            alarmNameSuffix,
            alarmLabel,
            alarmDescription,
            customTags: props.customTags,
            customParams: props.customParams,
            alarmRuleWhenOk: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.OK),
            alarmRuleWhenAlarming: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.ALARM),
            alarmRuleWhenInsufficientData: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.INSUFFICIENT_DATA),
            dedupeString,
            annotation,
            disambiguator: props.disambiguator,
        };
    }
    addCompositeAlarm(alarms, props) {
        const actionsEnabled = this.determineActionsEnabled(props?.actionsEnabled, props?.disambiguator);
        const action = props.actionOverride ?? this.globalAlarmDefaults.action ?? action_1.noopAction();
        const namingInput = { alarmNameSuffix: "Composite", ...props };
        const alarmName = this.alarmNamingStrategy.getName(namingInput);
        const alarmDescription = this.generateDescription(props?.alarmDescription ?? "Composite alarm", props?.alarmDescriptionOverride, props?.runbookLink, props?.documentationLink);
        const dedupeString = this.alarmNamingStrategy.getDedupeString(namingInput);
        const alarmRule = this.determineCompositeAlarmRule(alarms, props);
        const alarm = new aws_cloudwatch_1.CompositeAlarm(this.alarmScope, alarmName, {
            compositeAlarmName: alarmName,
            alarmDescription,
            alarmRule,
            actionsEnabled,
        });
        action.addAlarmActions({
            alarm,
            action,
            dedupeString,
            disambiguator: props?.disambiguator,
            customTags: props?.customTags,
            customParams: props?.customParams,
        });
        return alarm;
    }
    determineCompositeAlarmRule(alarms, props) {
        const alarmRules = alarms.map((alarm) => alarm.alarmRuleWhenAlarming);
        const operator = props.compositeOperator ?? CompositeAlarmOperator.OR;
        switch (operator) {
            case CompositeAlarmOperator.AND:
                return aws_cloudwatch_1.AlarmRule.allOf(...alarmRules);
            case CompositeAlarmOperator.OR:
                return aws_cloudwatch_1.AlarmRule.anyOf(...alarmRules);
            default:
                throw new Error(`Unsupported composite alarm operator: ${operator}`);
        }
    }
    determineActionsEnabled(actionsEnabled, disambiguator) {
        if (actionsEnabled !== undefined) {
            // alarm-specific override to true or false
            return actionsEnabled;
        }
        if (typeof this.globalAlarmDefaults.actionsEnabled === "boolean") {
            // global defaults: boolean value
            return this.globalAlarmDefaults.actionsEnabled;
        }
        if (disambiguator) {
            // global defaults: disambiguator based value
            return this.globalAlarmDefaults.actionsEnabled[disambiguator] ?? false;
        }
        return false;
    }
    determineAction(disambiguator, actionOverride) {
        // Explicit override
        if (actionOverride) {
            return actionOverride;
        }
        // Default by disambiugator
        if (disambiguator &&
            this.globalAlarmDefaults.disambiguatorAction?.[disambiguator]) {
            return this.globalAlarmDefaults.disambiguatorAction[disambiguator];
        }
        // Default global action
        return this.globalAlarmDefaults.action ?? action_1.noopAction();
    }
    get shouldUseDefaultDedupeForError() {
        return this.globalAlarmDefaults.useDefaultDedupeForError ?? true;
    }
    get shouldUseDefaultDedupeForLatency() {
        return this.globalAlarmDefaults.useDefaultDedupeForLatency ?? true;
    }
    generateDescription(alarmDescription, alarmDescriptionOverride, runbookLinkOverride, documentationLinkOverride) {
        const parts = [alarmDescriptionOverride ?? alarmDescription];
        const runbookLink = runbookLinkOverride ?? this.globalAlarmDefaults.runbookLink;
        const documentationLink = documentationLinkOverride ?? this.globalAlarmDefaults.documentationLink;
        if (runbookLink) {
            parts.push(`Runbook: ${runbookLink}`);
        }
        if (documentationLink) {
            parts.push(`Documentation: ${documentationLink}`);
        }
        return this.joinDescriptionParts(...parts);
    }
    joinDescriptionParts(...parts) {
        return parts.join(" \r\n");
    }
    createAnnotation(props) {
        const strategy = this.globalAlarmDefaults.annotationStrategy ??
            new IAlarmAnnotationStrategy_1.DefaultAlarmAnnotationStrategy();
        return strategy.createAnnotation(props);
    }
}
exports.AlarmFactory = AlarmFactory;
_a = JSII_RTTI_SYMBOL_1;
AlarmFactory[_a] = { fqn: "cdk-monitoring-constructs.AlarmFactory", version: "0.0.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWxhcm1GYWN0b3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQWxhcm1GYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsK0RBWW9DO0FBR3BDLHFDQUE0RDtBQUM1RCwrREFBNEQ7QUFDNUQseUVBSW9DO0FBR3BDLHVEQUkyQjtBQUMzQixzQ0FJbUI7QUFFbkIsTUFBTSx3QkFBd0IsR0FBRyxDQUFDLENBQUM7QUEyV25DLElBQVksc0JBVVg7QUFWRCxXQUFZLHNCQUFzQjtJQUNoQzs7T0FFRztJQUNILGlFQUFHLENBQUE7SUFFSDs7T0FFRztJQUNILCtEQUFFLENBQUE7QUFDSixDQUFDLEVBVlcsc0JBQXNCLEdBQXRCLDhCQUFzQixLQUF0Qiw4QkFBc0IsUUFVakM7QUFtR0QsTUFBYSxZQUFZO0lBTXZCLFlBQVksVUFBcUIsRUFBRSxLQUF3QjtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLG1CQUFtQixDQUFDO1FBQ3JELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUMsb0JBQW9CLENBQUM7UUFDdkQsSUFBSSxDQUFDLG1CQUFtQjtZQUN0QixLQUFLLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CO2dCQUM3QyxJQUFJLHlDQUFtQixDQUNyQixLQUFLLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUN6QyxLQUFLLENBQUMsb0JBQW9CLEVBQzFCLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxxQkFBcUIsQ0FDaEQsQ0FBQztJQUNOLENBQUM7SUFFRCxRQUFRLENBQ04sTUFBOEIsRUFDOUIsS0FBb0I7UUFFcEIsb0JBQW9CO1FBRXBCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjO1lBQ3pDLENBQUMsQ0FBQyx5Q0FBdUIsQ0FBQyxFQUFFLENBQ3hCLEtBQUssQ0FBQyxjQUFjLEVBQ3BCLHVDQUFxQixDQUFDLFFBQVEsQ0FDL0I7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LHdCQUF3QixJQUFJLGdCQUFnQixDQUFDLENBQUM7UUFFN0QsTUFBTSxXQUFXLEdBQ2YsbUJBQW1CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQztRQUM5RCxNQUFNLGlCQUFpQixHQUNyQix5QkFBeUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUM7UUFFMUUsSUFBSSxXQUFXLEVBQUU7WUFDZixLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksV0FBVyxFQUFFLENBQUMsQ0FBQztTQUN2QztRQUVELElBQUksaUJBQWlCLEVBQUU7WUFDckIsS0FBSyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRVMsb0JBQW9CLENBQUMsR0FBRyxLQUFlO1FBQy9DLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRVMsZ0JBQWdCLENBQUMsS0FBbUM7UUFDNUQsTUFBTSxRQUFRLEdBQ1osSUFBSSxDQUFDLG1CQUFtQixDQUFDLGtCQUFrQjtZQUMzQyxJQUFJLHlEQUE4QixFQUFFLENBQUM7UUFDdkMsT0FBTyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUMsQ0FBQzs7QUFoWUgsb0NBaVlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHVyYXRpb24gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7XG4gIEFsYXJtQmFzZSxcbiAgQWxhcm1SdWxlLFxuICBBbGFybVN0YXRlLFxuICBDb21wYXJpc29uT3BlcmF0b3IsXG4gIENvbXBvc2l0ZUFsYXJtLFxuICBIb3Jpem9udGFsQW5ub3RhdGlvbixcbiAgSUFsYXJtUnVsZSxcbiAgSU1ldHJpYyxcbiAgTWF0aEV4cHJlc3Npb24sXG4gIE1ldHJpYyxcbiAgVHJlYXRNaXNzaW5nRGF0YSxcbn0gZnJvbSBcImF3cy1jZGstbGliL2F3cy1jbG91ZHdhdGNoXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuXG5pbXBvcnQgeyBJQWxhcm1BY3Rpb25TdHJhdGVneSwgbm9vcEFjdGlvbiB9IGZyb20gXCIuL2FjdGlvblwiO1xuaW1wb3J0IHsgQWxhcm1OYW1pbmdTdHJhdGVneSB9IGZyb20gXCIuL0FsYXJtTmFtaW5nU3RyYXRlZ3lcIjtcbmltcG9ydCB7XG4gIEFsYXJtQW5ub3RhdGlvblN0cmF0ZWd5UHJvcHMsXG4gIERlZmF1bHRBbGFybUFubm90YXRpb25TdHJhdGVneSxcbiAgSUFsYXJtQW5ub3RhdGlvblN0cmF0ZWd5LFxufSBmcm9tIFwiLi9JQWxhcm1Bbm5vdGF0aW9uU3RyYXRlZ3lcIjtcbmltcG9ydCB7IElBbGFybURlZHVwZVN0cmluZ1Byb2Nlc3NvciB9IGZyb20gXCIuL0lBbGFybURlZHVwZVN0cmluZ1Byb2Nlc3NvclwiO1xuaW1wb3J0IHsgSUFsYXJtTmFtaW5nU3RyYXRlZ3kgfSBmcm9tIFwiLi9JQWxhcm1OYW1pbmdTdHJhdGVneVwiO1xuaW1wb3J0IHtcbiAgQ29tcG9zaXRlTWV0cmljQWRqdXN0ZXIsXG4gIERlZmF1bHRNZXRyaWNBZGp1c3RlcixcbiAgSU1ldHJpY0FkanVzdGVyLFxufSBmcm9tIFwiLi9tZXRyaWMtYWRqdXN0ZXJcIjtcbmltcG9ydCB7XG4gIE1ldHJpY0ZhY3RvcnlEZWZhdWx0cyxcbiAgTWV0cmljU3RhdGlzdGljLFxuICBNZXRyaWNXaXRoQWxhcm1TdXBwb3J0LFxufSBmcm9tIFwiLi4vbWV0cmljXCI7XG5cbmNvbnN0IERlZmF1bHREYXRhcG9pbnRzVG9BbGFybSA9IDM7XG5cbi8qKlxuICogQ29tbW9ubHkgdXNlZCBkaXNhbWJpZ3VhdG9ycy5cbiAqL1xuZXhwb3J0IHR5cGUgUHJlZGVmaW5lZEFsYXJtRGlzYW1iaWd1YXRvcnMgPSBcIldhcm5pbmdcIiB8IFwiQ3JpdGljYWxcIjtcblxuLyoqXG4gKiBNZXRhZGF0YSBvZiBhbiBhbGFybS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBbGFybU1ldGFkYXRhIHtcbiAgcmVhZG9ubHkgYWN0aW9uOiBJQWxhcm1BY3Rpb25TdHJhdGVneTtcbiAgcmVhZG9ubHkgZGVkdXBlU3RyaW5nPzogc3RyaW5nO1xuICByZWFkb25seSBkaXNhbWJpZ3VhdG9yPzogc3RyaW5nO1xuICByZWFkb25seSBjdXN0b21UYWdzPzogc3RyaW5nW107XG4gIHJlYWRvbmx5IGN1c3RvbVBhcmFtcz86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbi8qKlxuICogUmVwcmVzZW50YXRpb24gb2YgYW4gYWxhcm0gd2l0aCBhZGRpdGlvbmFsIGluZm9ybWF0aW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFsYXJtV2l0aEFubm90YXRpb24gZXh0ZW5kcyBBbGFybU1ldGFkYXRhIHtcbiAgcmVhZG9ubHkgYWxhcm06IEFsYXJtQmFzZTtcbiAgcmVhZG9ubHkgYWxhcm1OYW1lOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGFsYXJtTmFtZVN1ZmZpeDogc3RyaW5nO1xuICByZWFkb25seSBhbGFybUxhYmVsOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGFsYXJtRGVzY3JpcHRpb246IHN0cmluZztcbiAgcmVhZG9ubHkgYWxhcm1SdWxlV2hlbk9rOiBJQWxhcm1SdWxlO1xuICByZWFkb25seSBhbGFybVJ1bGVXaGVuQWxhcm1pbmc6IElBbGFybVJ1bGU7XG4gIHJlYWRvbmx5IGFsYXJtUnVsZVdoZW5JbnN1ZmZpY2llbnREYXRhOiBJQWxhcm1SdWxlO1xuICByZWFkb25seSBhbm5vdGF0aW9uOiBIb3Jpem9udGFsQW5ub3RhdGlvbjtcbn1cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIG5lY2Vzc2FyeSB0byBjcmVhdGUgYSBzaW5nbGUgYWxhcm0gYW5kIGNvbmZpZ3VyZSBpdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZGRBbGFybVByb3BzIHtcbiAgLyoqXG4gICAqIEFsbG93cyB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBhY3Rpb24gc3RyYXRlZ3kuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBhY3Rpb24gd2lsbCBiZSB1c2VkXG4gICAqL1xuICByZWFkb25seSBhY3Rpb25PdmVycmlkZT86IElBbGFybUFjdGlvblN0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIGRlZmluZWQsIHRoZSBhbGFybSBkZWR1cGUgc3RyaW5nIGlzIHNldCB0byB0aGlzIGV4YWN0IHZhbHVlLlxuICAgKiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB5b3UgbmVlZCB0byBoYW5kbGUgZGVkdXBpbmcgZm9yIGRpZmZlcmVudCBzdGFnZXMgKEJldGEsIFByb2QuLi4pIGFuZCByZWdpb25zIChFVSwgTkEuLi4pIG1hbnVhbGx5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAobm8gb3ZlcnJpZGUpXG4gICAqL1xuICByZWFkb25seSBkZWR1cGVTdHJpbmdPdmVycmlkZT86IHN0cmluZztcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkLCB0aGUgYWxhcm0gbmFtZSBpcyBzZXQgdG8gdGhpcyBleGFjdCB2YWx1ZS5cbiAgICogUGxlYXNlIGJlIGF3YXJlIHRoYXQgeW91IG5lZWQgdG8gc3BlY2lmeSBwcmVmaXggZm9yIGRpZmZlcmVudCBzdGFnZXMgKEJldGEsIFByb2QuLi4pIGFuZCByZWdpb25zIChFVSwgTkEuLi4pIG1hbnVhbGx5LlxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1OYW1lT3ZlcnJpZGU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEEgdGV4dCBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LCB3aGljaCBmdWxseSByZXBsYWNlcyB0aGUgZ2VuZXJhdGVkIHRleHQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBhdXRvLWdlbmVyYXRlZCBjb250ZW50IG9ubHlcbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtRGVzY3JpcHRpb25PdmVycmlkZT86IHN0cmluZztcblxuICAvKipcbiAgICogRGlzYW1iaWd1YXRvciBpcyBhIHN0cmluZyB0aGF0IGRpZmZlcmVudGlhdGVzIHRoaXMgYWxhcm0gZnJvbSBvdGhlciBzaW1pbGFyIG9uZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkIChubyBkaXNhbWJpZ3VhdG9yKVxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYW1iaWd1YXRvcj86IHN0cmluZztcblxuICAvKipcbiAgICogQWxhcm0gZGVzY3JpcHRpb24gaXMgaW5jbHVkZWQgaW4gdGhlIHRpY2tldCBhbmQgdGhlcmVmb3JlIHNob3VsZCBkZXNjcmliZSB3aGF0IGhhcHBlbmVkLCB3aXRoIGFzIG11Y2ggY29udGV4dCBhcyBwb3NzaWJsZS5cbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtRGVzY3JpcHRpb246IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgbGluayB3aWxsIGJlIGFkZGVkXG4gICAqL1xuICByZWFkb25seSBkb2N1bWVudGF0aW9uTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgbGluayB3aWxsIGJlIGFkZGVkXG4gICAqL1xuICByZWFkb25seSBydW5ib29rTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogU3VmZml4IGFkZGVkIHRvIGJhc2UgYWxhcm0gbmFtZS4gQWxhcm0gbmFtZXMgbmVlZCB0byBiZSB1bmlxdWUuXG4gICAqL1xuICByZWFkb25seSBhbGFybU5hbWVTdWZmaXg6IHN0cmluZztcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkLCB0aGUgZGVmYXVsdCByZXNvdXJjZS1zcGVjaWZpYyBhbGFybSBkZWR1cGUgc3RyaW5nIHdpbGwgYmUgc2V0IGFuZCB0aGlzIHdpbGwgYmUgYWRkZWQgYXMgYSBzdWZmaXguXG4gICAqIFRoaXMgYWxsb3dzIHlvdSB0byBzcGVjaWZ5IHRoZSBzYW1lIGRlZHVwZSBzdHJpbmcgZm9yIGEgZmFtaWx5IG9mIGFsYXJtcy5cbiAgICogQ2Fubm90IGJlIGRlZmluZWQgYXQgdGhlIHNhbWUgdGltZSBhcyBhbGFybURlZHVwZVN0cmluZ092ZXJyaWRlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAobm8gc3VmZml4KVxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZWR1cGVTdHJpbmdTdWZmaXg/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEVuYWJsZXMgdGhlIGNvbmZpZ3VyZWQgQ2xvdWRXYXRjaCBhbGFybSB0aWNrZXRpbmcgYWN0aW9ucy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0aGUgc2FtZSBhcyBtb25pdG9yaW5nIGZhY2FkZSBkZWZhdWx0XG4gICAqL1xuICByZWFkb25seSBhY3Rpb25zRW5hYmxlZD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFRocmVzaG9sZCB0byBhbGFybSBvbi5cbiAgICovXG4gIHJlYWRvbmx5IHRocmVzaG9sZDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBDb21wYXJpc29uIG9wZXJhdG9yIHVzZWQgdG8gY29tcGFyZSBhY3R1YWwgdmFsdWUgYWdhaW5zdCB0aGUgdGhyZXNob2xkLlxuICAgKi9cbiAgcmVhZG9ubHkgY29tcGFyaXNvbk9wZXJhdG9yOiBDb21wYXJpc29uT3BlcmF0b3I7XG5cbiAgLyoqXG4gICAqIEJlaGF2aW91ciBpbiBjYXNlIHRoZSBtZXRyaWMgZGF0YSBpcyBtaXNzaW5nLlxuICAgKi9cbiAgcmVhZG9ubHkgdHJlYXRNaXNzaW5nRGF0YTogVHJlYXRNaXNzaW5nRGF0YTtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIGJyZWFjaGVzIHJlcXVpcmVkIHRvIHRyYW5zaXRpb24gaW50byBhbiBBTEFSTSBzdGF0ZS5cbiAgICovXG4gIHJlYWRvbmx5IGRhdGFwb2ludHNUb0FsYXJtPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBOdW1iZXIgb2YgcGVyaW9kcyB0byBjb25zaWRlciB3aGVuIGNoZWNraW5nIHRoZSBudW1iZXIgb2YgYnJlYWNoaW5nIGRhdGFwb2ludHMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2FtZSBhcyBkYXRhcG9pbnRzVG9BbGFybS5cbiAgICovXG4gIHJlYWRvbmx5IGV2YWx1YXRpb25QZXJpb2RzPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBQZXJpb2Qgb3ZlcnJpZGUgZm9yIHRoZSBtZXRyaWMgdG8gYWxhcm0gb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdGhlIGRlZmF1bHQgc3BlY2lmaWVkIGluIE1ldHJpY0ZhY3RvcnlcbiAgICovXG4gIHJlYWRvbmx5IHBlcmlvZD86IER1cmF0aW9uO1xuXG4gIC8qKlxuICAgKiBVc2VkIG9ubHkgZm9yIGFsYXJtcyBiYXNlZCBvbiBwZXJjZW50aWxlcy5cbiAgICogSWYgeW91IHNwZWNpZnkgPGNvZGU+ZmFsc2U8L2NvZGU+LCB0aGUgYWxhcm0gc3RhdGUgZG9lcyBub3QgY2hhbmdlIGR1cmluZyBwZXJpb2RzIHdpdGggdG9vIGZldyBkYXRhIHBvaW50cyB0byBiZSBzdGF0aXN0aWNhbGx5IHNpZ25pZmljYW50LlxuICAgKiBJZiB5b3Ugc3BlY2lmeSA8Y29kZT50cnVlPC9jb2RlPiwgdGhlIGFsYXJtIGlzIGFsd2F5cyBldmFsdWF0ZWQgYW5kIHBvc3NpYmx5IGNoYW5nZXMgc3RhdGUgbm8gbWF0dGVyIGhvdyBtYW55IGRhdGEgcG9pbnRzIGFyZSBhdmFpbGFibGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgZXZhbHVhdGVMb3dTYW1wbGVDb3VudFBlcmNlbnRpbGU/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgaG93IG1hbnkgc2FtcGxlcyAoTikgb2YgdGhlIG1ldHJpYyBpcyBuZWVkZWQgaW4gYSBkYXRhcG9pbnQgdG8gYmUgZXZhbHVhdGVkIGZvciBhbGFybWluZy5cbiAgICogSWYgdGhpcyBwcm9wZXJ0eSBpcyBzcGVjaWZpZWQsIHlvdXIgbWV0cmljIHdpbGwgYmUgc3ViamVjdCB0byBNYXRoRXhwcmVzc2lvbiB0aGF0IHdpbGwgYWRkIGFuIElGIGNvbmRpdGlvblxuICAgKiB0byB5b3VyIG1ldHJpYyB0byBtYWtlIHN1cmUgdGhhdCBlYWNoIGRhdGFwb2ludCBpcyBldmFsdWF0ZWQgb25seSBpZiBpdCBoYXMgc3VmZmljaWVudCBudW1iZXIgb2Ygc2FtcGxlcy5cbiAgICogSWYgdGhlIG51bWJlciBvZiBzYW1wbGVzIGlzIG5vdCBzdWZmaWNpZW50LCB0aGUgZGF0YXBvaW50IHdpbGwgYmUgdHJlYXRlZCBhcyBtaXNzaW5nIGRhdGEgYW5kIHdpbGwgYmUgZXZhbHVhdGVkXG4gICAqIGFjY29yZGluZyB0byB0aGUgdHJlYXRNaXNzaW5nRGF0YSBwYXJhbWV0ZXIuXG4gICAqIElmIHNwZWNpZmllZCwgZGVwcmVjYXRlZCBtaW5NZXRyaWNTYW1wbGVzVG9BbGFybSBoYXMgbm8gZWZmZWN0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGRlZmF1bHQgYmVoYXZpb3VyIC0gbm8gY29uZGl0aW9uIG9uIHNhbXBsZSBjb3VudCB3aWxsIGJlIHVzZWRcbiAgICovXG4gIHJlYWRvbmx5IG1pblNhbXBsZUNvdW50VG9FdmFsdWF0ZURhdGFwb2ludD86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhpcyBwcm9wZXJ0eSBpcyByZXF1aXJlZCBpbiB0aGUgZm9sbG93aW5nIHNpdHVhdGlvbjpcbiAgICogPG9sPlxuICAgKiAgICAgPGxpPjxjb2RlPm1pblNhbXBsZUNvdW50VG9FdmFsdWF0ZURhdGFwb2ludDwvY29kZT4gaXMgc3BlY2lmaWVkPC9saT5cbiAgICogICAgIDxsaT50aGUgbWV0cmljIHVzZWQgZm9yIHRoZSBhbGFybSBpcyBhIDxjb2RlPk1hdGhFeHByZXNzaW9uPC9jb2RlPjwvbGk+XG4gICAqICAgICA8bGk+dGhlIDxjb2RlPk1hdGhFeHByZXNzaW9uPC9jb2RlPiBpcyBjb21wb3NlZCBvZiBtb3JlIHRoYW4gb25lIG1ldHJpYzwvbGk+XG4gICAqIDwvb2w+XG4gICAqXG4gICAqIEluIHRoaXMgc2l0dWF0aW9uLCB0aGlzIHByb3BlcnR5IGluZGljYXRlcyB0aGUgbWV0cmljIElkIGluIHRoZSBNYXRoRXhwcmVzc2lvbuKAmXMgPGNvZGU+dXNpbmdNZXRyaWNzPC9jb2RlPlxuICAgKiBwcm9wZXJ0eSB0aGF0IHNob3VsZCBiZSB1c2VkIGFzIHRoZSBzYW1wbGVDb3VudCBtZXRyaWMgZm9yIHRoZSBuZXcgTWF0aEV4cHJlc3Npb24gYXMgZGVzY3JpYmVkIGluIHRoZSBkb2N1bWVudGF0aW9uXG4gICAqIGZvciA8Y29kZT5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQ8L2NvZGU+LlxuICAgKi9cbiAgcmVhZG9ubHkgc2FtcGxlQ291bnRNZXRyaWNJZD86IHN0cmluZztcblxuICAvKipcbiAgICogU3BlY2lmaWVzIGhvdyBtYW55IHNhbXBsZXMgKE4pIG9mIHRoZSBtZXRyaWMgaXMgbmVlZGVkIHRvIHRyaWdnZXIgdGhlIGFsYXJtLlxuICAgKiBJZiB0aGlzIHByb3BlcnR5IGlzIHNwZWNpZmllZCwgYW4gYXJ0aWZpY2lhbCBjb21wb3NpdGUgYWxhcm0gaXMgY3JlYXRlZCBvZiB0aGUgZm9sbG93aW5nOlxuICAgKiA8dWw+XG4gICAqIDxsaT5UaGUgb3JpZ2luYWwgYWxhcm0sIGNyZWF0ZWQgd2l0aG91dCB0aGlzIHByb3BlcnR5IGJlaW5nIHVzZWQ7IHRoaXMgYWxhcm0gd2lsbCBoYXZlIG5vIGFjdGlvbnMgc2V0LjwvbGk+XG4gICAqIDxsaT5BIHNlY29uZGFyeSBhbGFybSwgd2hpY2ggd2lsbCBtb25pdG9yIHRoZSBzYW1lIG1ldHJpYyB3aXRoIHRoZSBOIChTYW1wbGVDb3VudCkgc3RhdGlzdGljLCBjaGVja2luZyB0aGUgc2FtcGxlIGNvdW50LjwvbGk+XG4gICAqIDwvdWw+XG4gICAqIFRoZSBuZXdseSBjcmVhdGVkIGNvbXBvc2l0ZSBhbGFybSB3aWxsIGJlIHJldHVybmVkIGFzIGEgcmVzdWx0LCBhbmQgaXQgd2lsbCB0YWtlIHRoZSBvcmlnaW5hbCBhbGFybSBhY3Rpb25zLlxuICAgKiBAZGVmYXVsdCAtIGRlZmF1bHQgYmVoYXZpb3VyIC0gbm8gY29uZGl0aW9uIG9uIHNhbXBsZSBjb3VudCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBhbGFybVxuICAgKiBAZGVwcmVjYXRlZCBVc2UgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50IGluc3RlYWQuIG1pbk1ldHJpY1NhbXBsZXNBbGFybSB1c2VzIGRpZmZlcmVudCBldmFsdWF0aW9uXG4gICAqICAgcGVyaW9kIGZvciBpdHMgY2hpbGQgYWxhcm1zLCBzbyBpdCBkb2Vzbid0IGd1YXJhbnRlZSB0aGF0IGVhY2ggZGF0YXBvaW50IGluIHRoZSBldmFsdWF0aW9uIHBlcmlvZCBoYXNcbiAgICogICBzdWZmaWNpZW50IG51bWJlciBvZiBzYW1wbGVzXG4gICAqL1xuICByZWFkb25seSBtaW5NZXRyaWNTYW1wbGVzVG9BbGFybT86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhpcyBhbGxvd3MgdXNlciB0byBhdHRhY2ggY3VzdG9tIHZhbHVlcyB0byB0aGlzIGFsYXJtLCB3aGljaCBjYW4gbGF0ZXIgYmUgYWNjZXNzZWQgZnJvbSB0aGUgXCJ1c2VDcmVhdGVkQWxhcm1zXCIgbWV0aG9kLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHRhZ3NcbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbVRhZ3M/OiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogVGhpcyBhbGxvd3MgdXNlciB0byBhdHRhY2ggY3VzdG9tIHBhcmFtZXRlcnMgdG8gdGhpcyBhbGFybSwgd2hpY2ggY2FuIGxhdGVyIGJlIGFjY2Vzc2VkIGZyb20gdGhlIFwidXNlQ3JlYXRlZEFsYXJtc1wiIG1ldGhvZC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBwYXJhbWV0ZXJzXG4gICAqL1xuICByZWFkb25seSBjdXN0b21QYXJhbXM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgYWxhcm1pbmcgcmFuZ2Ugb2YgdmFsdWVzIHNob3VsZCBiZSBoaWdobGlnaHRlZCBpbiB0aGUgd2lkZ2V0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBmaWxsQWxhcm1SYW5nZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIElmIHNwZWNpZmllZCwgaXQgbW9kaWZpZXMgdGhlIGZpbmFsIGFsYXJtIGFubm90YXRpb24gY29sb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gb3ZlcnJpZGUgKGRlZmF1bHQgY29sb3IpXG4gICAqL1xuICByZWFkb25seSBvdmVycmlkZUFubm90YXRpb25Db2xvcj86IHN0cmluZztcblxuICAvKipcbiAgICogSWYgc3BlY2lmaWVkLCBpdCBtb2RpZmllcyB0aGUgZmluYWwgYWxhcm0gYW5ub3RhdGlvbiBsYWJlbC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBvdmVycmlkZSAoZGVmYXVsdCBsYWJlbClcbiAgICovXG4gIHJlYWRvbmx5IG92ZXJyaWRlQW5ub3RhdGlvbkxhYmVsPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJZiBzcGVjaWZpZWQsIGl0IG1vZGlmaWVzIHRoZSBmaW5hbCBhbGFybSBhbm5vdGF0aW9uIHZpc2liaWxpdHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gb3ZlcnJpZGUgKGRlZmF1bHQgdmlzaWJpbGl0eSlcbiAgICovXG4gIHJlYWRvbmx5IG92ZXJyaWRlQW5ub3RhdGlvblZpc2liaWxpdHk/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBJZiBzcGVjaWZpZWQsIGFkanVzdHMgdGhlIG1ldHJpYyBiZWZvcmUgY3JlYXRpbmcgYW4gYWxhcm0gZnJvbSBpdC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBhZGp1c3RlclxuICAgKi9cbiAgcmVhZG9ubHkgbWV0cmljQWRqdXN0ZXI/OiBJTWV0cmljQWRqdXN0ZXI7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBuZWNlc3NhcnkgdG8gY3JlYXRlIGEgY29tcG9zaXRlIGFsYXJtIGFuZCBjb25maWd1cmUgaXQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWRkQ29tcG9zaXRlQWxhcm1Qcm9wcyB7XG4gIC8qKlxuICAgKiBBbGxvd3MgdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgYWN0aW9uIHN0cmF0ZWd5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGRlZmF1bHQgYWN0aW9uIHdpbGwgYmUgdXNlZFxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uT3ZlcnJpZGU/OiBJQWxhcm1BY3Rpb25TdHJhdGVneTtcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkLCB0aGUgYWxhcm0gZGVkdXBlIHN0cmluZyBpcyBzZXQgdG8gdGhpcyBleGFjdCB2YWx1ZS5cbiAgICogUGxlYXNlIGJlIGF3YXJlIHRoYXQgeW91IG5lZWQgdG8gaGFuZGxlIGRlZHVwaW5nIGZvciBkaWZmZXJlbnQgc3RhZ2VzIChCZXRhLCBQcm9kLi4uKSBhbmQgcmVhbG1zIChFVSwgTkEuLi4pIG1hbnVhbGx5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAobm8gb3ZlcnJpZGUpXG4gICAqL1xuICByZWFkb25seSBkZWR1cGVTdHJpbmdPdmVycmlkZT86IHN0cmluZztcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkLCB0aGUgYWxhcm0gbmFtZSBpcyBzZXQgdG8gdGhpcyBleGFjdCB2YWx1ZS5cbiAgICogUGxlYXNlIGJlIGF3YXJlIHRoYXQgeW91IG5lZWQgdG8gc3BlY2lmeSBwcmVmaXggZm9yIGRpZmZlcmVudCBzdGFnZXMgKEJldGEsIFByb2QuLi4pIGFuZCByZWFsbXMgKEVVLCBOQS4uLikgbWFudWFsbHkuXG4gICAqL1xuICByZWFkb25seSBhbGFybU5hbWVPdmVycmlkZT86IHN0cmluZztcblxuICAvKipcbiAgICogQSB0ZXh0IGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHksIHdoaWNoIGZ1bGx5IHJlcGxhY2VzIHRoZSBnZW5lcmF0ZWQgdGV4dC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBkZWZhdWx0IGF1dG8tZ2VuZXJhdGVkIGNvbnRlbnQgb25seVxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZXNjcmlwdGlvbk92ZXJyaWRlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEaXNhbWJpZ3VhdG9yIGlzIGEgc3RyaW5nIHRoYXQgZGlmZmVyZW50aWF0ZXMgdGhpcyBhbGFybSBmcm9tIG90aGVyIHNpbWlsYXIgb25lcy5cbiAgICovXG4gIHJlYWRvbmx5IGRpc2FtYmlndWF0b3I6IHN0cmluZztcblxuICAvKipcbiAgICogQWxhcm0gZGVzY3JpcHRpb24gaXMgaW5jbHVkZWQgaW4gdGhlIHRpY2tldCBhbmQgdGhlcmVmb3JlIHNob3VsZCBkZXNjcmliZSB3aGF0IGhhcHBlbmVkLCB3aXRoIGFzIG11Y2ggY29udGV4dCBhcyBwb3NzaWJsZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBkZXNjcmlwdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgbGluayB3aWxsIGJlIGFkZGVkXG4gICAqL1xuICByZWFkb25seSBkb2N1bWVudGF0aW9uTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkZGl0aW9uYWwgbGluayB3aWxsIGJlIGFkZGVkXG4gICAqL1xuICByZWFkb25seSBydW5ib29rTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogU3VmZml4IGFkZGVkIHRvIGJhc2UgYWxhcm0gbmFtZS4gQWxhcm0gbmFtZXMgbmVlZCB0byBiZSB1bmlxdWUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gc3VmZml4XG4gICAqL1xuICByZWFkb25seSBhbGFybU5hbWVTdWZmaXg/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIElmIHRoaXMgaXMgZGVmaW5lZCwgdGhlIGRlZmF1bHQgcmVzb3VyY2Utc3BlY2lmaWMgYWxhcm0gZGVkdXBlIHN0cmluZyB3aWxsIGJlIHNldCBhbmQgdGhpcyB3aWxsIGJlIGFkZGVkIGFzIGEgc3VmZml4LlxuICAgKiBUaGlzIGFsbG93cyB5b3UgdG8gc3BlY2lmeSB0aGUgc2FtZSBkZWR1cGUgc3RyaW5nIGZvciBhIGZhbWlseSBvZiBhbGFybXMuXG4gICAqIENhbm5vdCBiZSBkZWZpbmVkIGF0IHRoZSBzYW1lIHRpbWUgYXMgYWxhcm1EZWR1cGVTdHJpbmdPdmVycmlkZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB1bmRlZmluZWQgKG5vIHN1ZmZpeClcbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtRGVkdXBlU3RyaW5nU3VmZml4Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBFbmFibGVzIHRoZSBjb25maWd1cmVkIENsb3VkV2F0Y2ggYWxhcm0gdGlja2V0aW5nIGFjdGlvbnMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdGhlIHNhbWUgYXMgbW9uaXRvcmluZyBmYWNhZGUgZGVmYXVsdFxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uc0VuYWJsZWQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBUaGlzIGFsbG93cyB1c2VyIHRvIGF0dGFjaCBjdXN0b20gdmFsdWVzIHRvIHRoaXMgYWxhcm0sIHdoaWNoIGNhbiBsYXRlciBiZSBhY2Nlc3NlZCBmcm9tIHRoZSBcInVzZUNyZWF0ZWRBbGFybXNcIiBtZXRob2QuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gdGFnc1xuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tVGFncz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBUaGlzIGFsbG93cyB1c2VyIHRvIGF0dGFjaCBjdXN0b20gcGFyYW1ldGVycyB0byB0aGlzIGFsYXJtLCB3aGljaCBjYW4gbGF0ZXIgYmUgYWNjZXNzZWQgZnJvbSB0aGUgXCJ1c2VDcmVhdGVkQWxhcm1zXCIgbWV0aG9kLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHBhcmFtZXRlcnNcbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbVBhcmFtcz86IFJlY29yZDxzdHJpbmcsIGFueT47XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBhbGFybWluZyByYW5nZSBvZiB2YWx1ZXMgc2hvdWxkIGJlIGhpZ2hsaWdodGVkIGluIHRoZSB3aWRnZXQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGZpbGxBbGFybVJhbmdlPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogTG9naWNhbCBvcGVyYXRvciB1c2VkIHRvIGFnZ3JlZ2F0ZSB0aGUgc3RhdHVzIGluZGl2aWR1YWwgYWxhcm1zLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE9SXG4gICAqL1xuICByZWFkb25seSBjb21wb3NpdGVPcGVyYXRvcj86IENvbXBvc2l0ZUFsYXJtT3BlcmF0b3I7XG59XG5cbi8qKlxuICogRW5hYmxlIGFsYXJtIGFjdGlvbnMgZm9yIGFsbCBzZXZlcml0aWVzIChib29sZWFuKSBvciBwcm92aWRlIGEgbWFwcGluZyBvZiB0aGUgZGlzYW1iaWd1YXRvcnMgdG8gYm9vbGVhbnNcbiAqL1xuZXhwb3J0IHR5cGUgQWN0aW9uc0VuYWJsZWQgPVxuICB8IGJvb2xlYW5cbiAgfCBSZWNvcmQ8UHJlZGVmaW5lZEFsYXJtRGlzYW1iaWd1YXRvcnMgfCBzdHJpbmcsIGJvb2xlYW4+O1xuXG5leHBvcnQgZW51bSBDb21wb3NpdGVBbGFybU9wZXJhdG9yIHtcbiAgLyoqXG4gICAqIHRyaWdnZXIgb25seSBpZiBhbGwgdGhlIGFsYXJtcyBhcmUgdHJpZ2dlcmVkXG4gICAqL1xuICBBTkQsXG5cbiAgLyoqXG4gICAqIHRyaWdnZXIgaWYgYW55IG9mIHRoZSBhbGFybXMgaXMgdHJpZ2dlcmVkXG4gICAqL1xuICBPUixcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGFybUZhY3RvcnlEZWZhdWx0cyB7XG4gIC8qKlxuICAgKiBFbmFibGVzIHRoZSBjb25maWd1cmVkIENsb3VkV2F0Y2ggYWxhcm0gdGlja2V0aW5nIGFjdGlvbnMgZm9yIGVpdGhlciBhbGwgc2V2ZXJpdGllcywgb3IgcGVyIHNldmVyaXR5LlxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uc0VuYWJsZWQ6IEFjdGlvbnNFbmFibGVkO1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IGFsYXJtIGFjdGlvbiB1c2VkIGZvciBlYWNoIGFsYXJtLCB1bmxlc3MgaXQgaXMgb3ZlcnJpZGRlbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBhY3Rpb24uXG4gICAqL1xuICByZWFkb25seSBhY3Rpb24/OiBJQWxhcm1BY3Rpb25TdHJhdGVneTtcblxuICAvKipcbiAgICogT3B0aW9uYWwgYWxhcm0gYWN0aW9uIGZvciBlYWNoIGRpc2FtYmlndWF0b3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gR2xvYmFsIGFsYXJtIGFjdGlvbiBpZiBkZWZpbmVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYW1iaWd1YXRvckFjdGlvbj86IFJlY29yZDxcbiAgICBQcmVkZWZpbmVkQWxhcm1EaXNhbWJpZ3VhdG9ycyB8IHN0cmluZyxcbiAgICBJQWxhcm1BY3Rpb25TdHJhdGVneVxuICA+O1xuXG4gIC8qKlxuICAgKiBDdXN0b20gc3RyYXRlZ3kgdG8gY3JlYXRlIGFubm90YXRpb25zIGZvciBhbGFybXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBhbm5vdGF0aW9uc1xuICAgKi9cbiAgcmVhZG9ubHkgYW5ub3RhdGlvblN0cmF0ZWd5PzogSUFsYXJtQW5ub3RhdGlvblN0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBDdXN0b20gc3RyYXRlZ3kgdG8gcHJvY2VzcyBkZWR1cGUgc3RyaW5ncyBvZiB0aGUgYWxhcm1zXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgKG5vIGNoYW5nZSlcbiAgICovXG4gIHJlYWRvbmx5IGRlZHVwZVN0cmluZ1Byb2Nlc3Nvcj86IElBbGFybURlZHVwZVN0cmluZ1Byb2Nlc3NvcjtcblxuICAvKipcbiAgICogQ3VzdG9tIHN0cmF0ZWd5IHRvIG5hbWUgYWxhcm1zXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgKG5vIGNoYW5nZSlcbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtaW5nU3RyYXRlZ3k/OiBJQWxhcm1OYW1pbmdTdHJhdGVneTtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIGJyZWFjaGVzIHJlcXVpcmVkIHRvIHRyYW5zaXRpb24gaW50byBhbiBBTEFSTSBzdGF0ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAzXG4gICAqL1xuICByZWFkb25seSBkYXRhcG9pbnRzVG9BbGFybT86IG51bWJlcjtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIHBlcmlvZHMgdG8gY29uc2lkZXIgd2hlbiBjaGVja2luZyB0aGUgbnVtYmVyIG9mIGJyZWFjaGluZyBkYXRhcG9pbnRzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFNhbWUgYXMgZGF0YXBvaW50c1RvQWxhcm0uXG4gICAqL1xuICByZWFkb25seSBldmFsdWF0aW9uUGVyaW9kcz86IG51bWJlcjtcblxuICAvKipcbiAgICogR2xvYmFsIHByZWZpeCBmb3IgYWxsIGFsYXJtIG5hbWVzLiBUaGlzIHNob3VsZCBiZSBzb21ldGhpbmcgdW5pcXVlIHRvIGF2b2lkIHBvdGVudGlhbCBjb2xsaXNpb25zLlxuICAgKiBUaGlzIGlzIGlnbm9yZWQgaWYgYW4gYWxhcm0ncyBkZWR1cGVTdHJpbmdPdmVycmlkZSBpcyBkZWNsYXJlZC5cbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtZVByZWZpeDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqL1xuICByZWFkb25seSBkb2N1bWVudGF0aW9uTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKi9cbiAgcmVhZG9ubHkgcnVuYm9va0xpbms/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIElmIHRoaXMgaXMgZGVmaW5lZCBhcyBmYWxzZSBhbmQgZGVkdXBlU3RyaW5nT3ZlcnJpZGUgaXMgdW5kZWZpbmVkLCB0aGUgYWxhcm0gcHJlZml4IHdpbGwgYmUgcGFydCBvZiB0aGUgZGVkdXBlIHN0cmluZy5cbiAgICogVGhpcyBlc3NlbnRpYWxseSBzdG9wcyB0aGUgZGVkdXBlIG9mIGRpZmZlcmVudCBlcnJvcnMgdG9nZXRoZXIuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkICh0cnVlKVxuICAgKi9cbiAgcmVhZG9ubHkgdXNlRGVmYXVsdERlZHVwZUZvckVycm9yPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkIGFzIGZhbHNlIGFuZCBkZWR1cGVTdHJpbmdPdmVycmlkZSBpcyB1bmRlZmluZWQsIHRoZSBhbGFybSBwcmVmaXggd2lsbCBiZSBwYXJ0IG9mIHRoZSBkZWR1cGUgc3RyaW5nLlxuICAgKiBUaGlzIGVzc2VudGlhbGx5IHN0b3BzIHRoZSBkZWR1cGUgb2YgZGlmZmVyZW50IGxhdGVuY3kgaXNzdWVzIHRvZ2V0aGVyLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAodHJ1ZSlcbiAgICovXG4gIHJlYWRvbmx5IHVzZURlZmF1bHREZWR1cGVGb3JMYXRlbmN5PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGFybUZhY3RvcnlQcm9wcyB7XG4gIHJlYWRvbmx5IGdsb2JhbEFsYXJtRGVmYXVsdHM6IEFsYXJtRmFjdG9yeURlZmF1bHRzO1xuICByZWFkb25seSBnbG9iYWxNZXRyaWNEZWZhdWx0czogTWV0cmljRmFjdG9yeURlZmF1bHRzO1xuICByZWFkb25seSBsb2NhbEFsYXJtTmFtZVByZWZpeDogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQWxhcm1GYWN0b3J5IHtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGFsYXJtU2NvcGU6IENvbnN0cnVjdDtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGdsb2JhbEFsYXJtRGVmYXVsdHM6IEFsYXJtRmFjdG9yeURlZmF1bHRzO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZ2xvYmFsTWV0cmljRGVmYXVsdHM6IE1ldHJpY0ZhY3RvcnlEZWZhdWx0cztcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGFsYXJtTmFtaW5nU3RyYXRlZ3k6IElBbGFybU5hbWluZ1N0cmF0ZWd5O1xuXG4gIGNvbnN0cnVjdG9yKGFsYXJtU2NvcGU6IENvbnN0cnVjdCwgcHJvcHM6IEFsYXJtRmFjdG9yeVByb3BzKSB7XG4gICAgdGhpcy5hbGFybVNjb3BlID0gYWxhcm1TY29wZTtcbiAgICB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMgPSBwcm9wcy5nbG9iYWxBbGFybURlZmF1bHRzO1xuICAgIHRoaXMuZ2xvYmFsTWV0cmljRGVmYXVsdHMgPSBwcm9wcy5nbG9iYWxNZXRyaWNEZWZhdWx0cztcbiAgICB0aGlzLmFsYXJtTmFtaW5nU3RyYXRlZ3kgPVxuICAgICAgcHJvcHMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hbGFybU5hbWluZ1N0cmF0ZWd5ID8/XG4gICAgICBuZXcgQWxhcm1OYW1pbmdTdHJhdGVneShcbiAgICAgICAgcHJvcHMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hbGFybU5hbWVQcmVmaXgsXG4gICAgICAgIHByb3BzLmxvY2FsQWxhcm1OYW1lUHJlZml4LFxuICAgICAgICBwcm9wcy5nbG9iYWxBbGFybURlZmF1bHRzLmRlZHVwZVN0cmluZ1Byb2Nlc3NvclxuICAgICAgKTtcbiAgfVxuXG4gIGFkZEFsYXJtKFxuICAgIG1ldHJpYzogTWV0cmljV2l0aEFsYXJtU3VwcG9ydCxcbiAgICBwcm9wczogQWRkQWxhcm1Qcm9wc1xuICApOiBBbGFybVdpdGhBbm5vdGF0aW9uIHtcbiAgICAvLyBhZGp1c3QgdGhlIG1ldHJpY1xuXG4gICAgY29uc3QgbWV0cmljQWRqdXN0ZXIgPSBwcm9wcy5tZXRyaWNBZGp1c3RlclxuICAgICAgPyBDb21wb3NpdGVNZXRyaWNBZGp1c3Rlci5vZihcbiAgICAgICAgICBwcm9wcy5tZXRyaWNBZGp1c3RlcixcbiAgICAgICAgICBEZWZhdWx0TWV0cmljQWRqdXN0ZXIuSU5TVEFOQ0VcbiAgICAgICAgKVxuICAgICAgOiBEZWZhdWx0TWV0cmljQWRqdXN0ZXIuSU5TVEFOQ0U7XG4gICAgY29uc3QgYWRqdXN0ZWRNZXRyaWMgPSBtZXRyaWNBZGp1c3Rlci5hZGp1c3RNZXRyaWMoXG4gICAgICBtZXRyaWMsXG4gICAgICB0aGlzLmFsYXJtU2NvcGUsXG4gICAgICBwcm9wc1xuICAgICk7XG5cbiAgICAvLyBtZXRyaWMgdGhhdCB3aWxsIGJlIHVsdGltYXRlbHkgdXNlZCB0byBjcmVhdGUgdGhlIGFsYXJtXG4gICAgbGV0IGFsYXJtTWV0cmljOiBNZXRyaWNXaXRoQWxhcm1TdXBwb3J0ID0gYWRqdXN0ZWRNZXRyaWM7XG5cbiAgICAvLyBwcmVwYXJlIHByaW1hcnkgYWxhcm0gcHJvcGVydGllc1xuXG4gICAgY29uc3QgYWN0aW9uc0VuYWJsZWQgPSB0aGlzLmRldGVybWluZUFjdGlvbnNFbmFibGVkKFxuICAgICAgcHJvcHMuYWN0aW9uc0VuYWJsZWQsXG4gICAgICBwcm9wcy5kaXNhbWJpZ3VhdG9yXG4gICAgKTtcbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmRldGVybWluZUFjdGlvbihcbiAgICAgIHByb3BzLmRpc2FtYmlndWF0b3IsXG4gICAgICBwcm9wcy5hY3Rpb25PdmVycmlkZVxuICAgICk7XG4gICAgY29uc3QgYWxhcm1OYW1lID0gdGhpcy5hbGFybU5hbWluZ1N0cmF0ZWd5LmdldE5hbWUocHJvcHMpO1xuICAgIGNvbnN0IGFsYXJtTmFtZVN1ZmZpeCA9IHByb3BzLmFsYXJtTmFtZVN1ZmZpeDtcbiAgICBjb25zdCBhbGFybUxhYmVsID0gdGhpcy5hbGFybU5hbWluZ1N0cmF0ZWd5LmdldFdpZGdldExhYmVsKHByb3BzKTtcbiAgICBjb25zdCBhbGFybURlc2NyaXB0aW9uID0gdGhpcy5nZW5lcmF0ZURlc2NyaXB0aW9uKFxuICAgICAgcHJvcHMuYWxhcm1EZXNjcmlwdGlvbixcbiAgICAgIHByb3BzLmFsYXJtRGVzY3JpcHRpb25PdmVycmlkZSxcbiAgICAgIHByb3BzLnJ1bmJvb2tMaW5rLFxuICAgICAgcHJvcHMuZG9jdW1lbnRhdGlvbkxpbmtcbiAgICApO1xuICAgIGNvbnN0IGRlZHVwZVN0cmluZyA9IHRoaXMuYWxhcm1OYW1pbmdTdHJhdGVneS5nZXREZWR1cGVTdHJpbmcocHJvcHMpO1xuICAgIGNvbnN0IGV2YWx1YXRlTG93U2FtcGxlQ291bnRQZXJjZW50aWxlID1cbiAgICAgIHByb3BzLmV2YWx1YXRlTG93U2FtcGxlQ291bnRQZXJjZW50aWxlID8/IHRydWU7XG5cbiAgICBjb25zdCBkYXRhcG9pbnRzVG9BbGFybSA9XG4gICAgICBwcm9wcy5kYXRhcG9pbnRzVG9BbGFybSA/P1xuICAgICAgdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmRhdGFwb2ludHNUb0FsYXJtID8/XG4gICAgICBEZWZhdWx0RGF0YXBvaW50c1RvQWxhcm07XG4gICAgY29uc3QgZXZhbHVhdGlvblBlcmlvZHMgPVxuICAgICAgcHJvcHMuZXZhbHVhdGlvblBlcmlvZHMgPz9cbiAgICAgIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5ldmFsdWF0aW9uUGVyaW9kcyA/P1xuICAgICAgZGF0YXBvaW50c1RvQWxhcm07XG5cbiAgICBpZiAoZXZhbHVhdGlvblBlcmlvZHMgPCBkYXRhcG9pbnRzVG9BbGFybSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgZXZhbHVhdGlvblBlcmlvZHMgbXVzdCBiZSBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gZGF0YXBvaW50c1RvQWxhcm0gZm9yICR7YWxhcm1OYW1lfWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gYXBwbHkgbWV0cmljIG1hdGggZm9yIG1pbmltdW0gbWV0cmljIHNhbXBsZXNcblxuICAgIGlmIChwcm9wcy5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQpIHtcbiAgICAgIGxldCBsYWJlbDogc3RyaW5nID0gYCR7YWRqdXN0ZWRNZXRyaWN9YDtcbiAgICAgIGxldCBtZXRyaWNFeHByZXNzaW9uOiBzdHJpbmc7XG4gICAgICBsZXQgbWV0cmljU2FtcGxlQ291bnRJZDogc3RyaW5nID0gXCJzYW1wbGVDb3VudFwiO1xuICAgICAgbGV0IHVzaW5nTWV0cmljczogUmVjb3JkPHN0cmluZywgSU1ldHJpYz47XG5cbiAgICAgIGlmIChhZGp1c3RlZE1ldHJpYyBpbnN0YW5jZW9mIE1hdGhFeHByZXNzaW9uKSB7XG4gICAgICAgIGxhYmVsID0gYWRqdXN0ZWRNZXRyaWMubGFiZWwgPz8gbGFiZWw7XG4gICAgICAgIG1ldHJpY0V4cHJlc3Npb24gPSBgKCR7YWRqdXN0ZWRNZXRyaWMuZXhwcmVzc2lvbn0pYDtcblxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoYWRqdXN0ZWRNZXRyaWMudXNpbmdNZXRyaWNzKS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBjb25zdCBzYW1wbGVDb3VudE1ldHJpYyA9IChcbiAgICAgICAgICAgIGFkanVzdGVkTWV0cmljLnVzaW5nTWV0cmljc1tcbiAgICAgICAgICAgICAgT2JqZWN0LmtleXMoYWRqdXN0ZWRNZXRyaWMudXNpbmdNZXRyaWNzKVswXVxuICAgICAgICAgICAgXSBhcyBNZXRyaWNcbiAgICAgICAgICApLndpdGgoe1xuICAgICAgICAgICAgc3RhdGlzdGljOiBNZXRyaWNTdGF0aXN0aWMuTixcbiAgICAgICAgICAgIGxhYmVsOiBcIlNhbXBsZSBjb3VudFwiLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdXNpbmdNZXRyaWNzID0ge1xuICAgICAgICAgICAgLi4uYWRqdXN0ZWRNZXRyaWMudXNpbmdNZXRyaWNzLFxuICAgICAgICAgICAgW21ldHJpY1NhbXBsZUNvdW50SWRdOiBzYW1wbGVDb3VudE1ldHJpYyxcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKHByb3BzLnNhbXBsZUNvdW50TWV0cmljSWQpIHtcbiAgICAgICAgICB1c2luZ01ldHJpY3MgPSBhZGp1c3RlZE1ldHJpYy51c2luZ01ldHJpY3M7XG4gICAgICAgICAgbWV0cmljU2FtcGxlQ291bnRJZCA9IHByb3BzLnNhbXBsZUNvdW50TWV0cmljSWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgXCJzYW1wbGVDb3VudE1ldHJpY0lkIG11c3QgYmUgc3BlY2lmaWVkIHdoZW4gdXNpbmcgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50IHdpdGggYSBtdWx0aXBsZS1tZXRyaWMgTWF0aEV4cHJlc3Npb25cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG1ldHJpY0lkOiBzdHJpbmcgPSBcIm1ldHJpY1wiO1xuXG4gICAgICAgIG1ldHJpY0V4cHJlc3Npb24gPSBtZXRyaWNJZDtcbiAgICAgICAgdXNpbmdNZXRyaWNzID0ge1xuICAgICAgICAgIFttZXRyaWNJZF06IGFkanVzdGVkTWV0cmljLFxuICAgICAgICAgIFttZXRyaWNTYW1wbGVDb3VudElkXTogYWRqdXN0ZWRNZXRyaWMud2l0aCh7XG4gICAgICAgICAgICBzdGF0aXN0aWM6IE1ldHJpY1N0YXRpc3RpYy5OLFxuICAgICAgICAgICAgbGFiZWw6IFwiU2FtcGxlIGNvdW50XCIsXG4gICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGFsYXJtTWV0cmljID0gbmV3IE1hdGhFeHByZXNzaW9uKHtcbiAgICAgICAgbGFiZWwsXG4gICAgICAgIGV4cHJlc3Npb246IGBJRigke21ldHJpY1NhbXBsZUNvdW50SWR9ID4gJHtwcm9wcy5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnR9LCAke21ldHJpY0V4cHJlc3Npb259KWAsXG4gICAgICAgIHBlcmlvZDogYWRqdXN0ZWRNZXRyaWMucGVyaW9kLFxuICAgICAgICB1c2luZ01ldHJpY3MsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgcHJpbWFyeSBhbGFybVxuXG4gICAgY29uc3QgcHJpbWFyeUFsYXJtID0gYWxhcm1NZXRyaWMuY3JlYXRlQWxhcm0odGhpcy5hbGFybVNjb3BlLCBhbGFybU5hbWUsIHtcbiAgICAgIGFsYXJtTmFtZSxcbiAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICB0aHJlc2hvbGQ6IHByb3BzLnRocmVzaG9sZCxcbiAgICAgIGNvbXBhcmlzb25PcGVyYXRvcjogcHJvcHMuY29tcGFyaXNvbk9wZXJhdG9yLFxuICAgICAgdHJlYXRNaXNzaW5nRGF0YTogcHJvcHMudHJlYXRNaXNzaW5nRGF0YSxcbiAgICAgIC8vIGRlZmF1bHQgdmFsdWUgKHVuZGVmaW5lZCkgbWVhbnMgXCJldmFsdWF0ZVwiXG4gICAgICBldmFsdWF0ZUxvd1NhbXBsZUNvdW50UGVyY2VudGlsZTogZXZhbHVhdGVMb3dTYW1wbGVDb3VudFBlcmNlbnRpbGVcbiAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgOiBcImlnbm9yZVwiLFxuICAgICAgZGF0YXBvaW50c1RvQWxhcm0sXG4gICAgICBldmFsdWF0aW9uUGVyaW9kcyxcbiAgICAgIGFjdGlvbnNFbmFibGVkLFxuICAgIH0pO1xuXG4gICAgbGV0IGFsYXJtOiBBbGFybUJhc2UgPSBwcmltYXJ5QWxhcm07XG5cbiAgICAvLyBjcmVhdGUgY29tcG9zaXRlIGFsYXJtIGZvciBtaW4gbWV0cmljIHNhbXBsZXMgKGlmIGRlZmluZWQpXG4gICAgLy8gZGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50XG5cbiAgICBpZiAoXG4gICAgICAhcHJvcHMubWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50ICYmXG4gICAgICBwcm9wcy5taW5NZXRyaWNTYW1wbGVzVG9BbGFybVxuICAgICkge1xuICAgICAgY29uc3QgbWV0cmljU2FtcGxlQ291bnQgPSBhZGp1c3RlZE1ldHJpYy53aXRoKHtcbiAgICAgICAgc3RhdGlzdGljOiBNZXRyaWNTdGF0aXN0aWMuTixcbiAgICAgIH0pO1xuICAgICAgY29uc3Qgbm9TYW1wbGVzQWxhcm0gPSBtZXRyaWNTYW1wbGVDb3VudC5jcmVhdGVBbGFybShcbiAgICAgICAgdGhpcy5hbGFybVNjb3BlLFxuICAgICAgICBgJHthbGFybU5hbWV9LU5vU2FtcGxlc2AsXG4gICAgICAgIHtcbiAgICAgICAgICBhbGFybU5hbWU6IGAke2FsYXJtTmFtZX0tTm9TYW1wbGVzYCxcbiAgICAgICAgICBhbGFybURlc2NyaXB0aW9uOiBgVGhlIG1ldHJpYyAoJHthZGp1c3RlZE1ldHJpY30pIGRvZXMgbm90IGhhdmUgZW5vdWdoIHNhbXBsZXMgdG8gYWxhcm0uIE11c3QgaGF2ZSBhdCBsZWFzdCAke3Byb3BzLm1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtfS5gLFxuICAgICAgICAgIHRocmVzaG9sZDogcHJvcHMubWluTWV0cmljU2FtcGxlc1RvQWxhcm0sXG4gICAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBDb21wYXJpc29uT3BlcmF0b3IuTEVTU19USEFOX1RIUkVTSE9MRCxcbiAgICAgICAgICB0cmVhdE1pc3NpbmdEYXRhOiBUcmVhdE1pc3NpbmdEYXRhLkJSRUFDSElORyxcbiAgICAgICAgICBkYXRhcG9pbnRzVG9BbGFybTogMSxcbiAgICAgICAgICBldmFsdWF0aW9uUGVyaW9kczogMSxcbiAgICAgICAgICBhY3Rpb25zRW5hYmxlZCxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIGFsYXJtID0gbmV3IENvbXBvc2l0ZUFsYXJtKHRoaXMuYWxhcm1TY29wZSwgYCR7YWxhcm1OYW1lfS1XaXRoU2FtcGxlc2AsIHtcbiAgICAgICAgYWN0aW9uc0VuYWJsZWQsXG4gICAgICAgIGNvbXBvc2l0ZUFsYXJtTmFtZTogYCR7YWxhcm1OYW1lfS1XaXRoU2FtcGxlc2AsXG4gICAgICAgIGFsYXJtRGVzY3JpcHRpb246IHRoaXMuam9pbkRlc2NyaXB0aW9uUGFydHMoXG4gICAgICAgICAgYWxhcm1EZXNjcmlwdGlvbixcbiAgICAgICAgICBgTWluIG51bWJlciBvZiBzYW1wbGVzIHRvIGFsYXJtOiAke3Byb3BzLm1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtfWBcbiAgICAgICAgKSxcbiAgICAgICAgYWxhcm1SdWxlOiBBbGFybVJ1bGUuYWxsT2YoXG4gICAgICAgICAgQWxhcm1SdWxlLmZyb21BbGFybShwcmltYXJ5QWxhcm0sIEFsYXJtU3RhdGUuQUxBUk0pLFxuICAgICAgICAgIEFsYXJtUnVsZS5ub3QoQWxhcm1SdWxlLmZyb21BbGFybShub1NhbXBsZXNBbGFybSwgQWxhcm1TdGF0ZS5BTEFSTSkpXG4gICAgICAgICksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBhdHRhY2ggYWxhcm0gYWN0aW9uc1xuXG4gICAgYWN0aW9uLmFkZEFsYXJtQWN0aW9ucyh7XG4gICAgICBhbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGRlZHVwZVN0cmluZyxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzLmRpc2FtYmlndWF0b3IsXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzID8/IFtdLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMgPz8ge30sXG4gICAgfSk7XG5cbiAgICAvLyBjcmVhdGUgYW5ub3RhdGlvbiBmb3IgdGhlIHByaW1hcnkgYWxhcm1cblxuICAgIGNvbnN0IGFubm90YXRpb24gPSB0aGlzLmNyZWF0ZUFubm90YXRpb24oe1xuICAgICAgYWxhcm06IHByaW1hcnlBbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIG1ldHJpYzogYWRqdXN0ZWRNZXRyaWMsXG4gICAgICBldmFsdWF0aW9uUGVyaW9kcyxcbiAgICAgIGRhdGFwb2ludHNUb0FsYXJtLFxuICAgICAgZGVkdXBlU3RyaW5nLFxuICAgICAgbWluTWV0cmljU2FtcGxlc1RvQWxhcm06IHByb3BzLm1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtLFxuICAgICAgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50OlxuICAgICAgICBwcm9wcy5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQsXG4gICAgICBmaWxsQWxhcm1SYW5nZTogcHJvcHMuZmlsbEFsYXJtUmFuZ2UgPz8gZmFsc2UsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25Db2xvcjogcHJvcHMub3ZlcnJpZGVBbm5vdGF0aW9uQ29sb3IsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25MYWJlbDogcHJvcHMub3ZlcnJpZGVBbm5vdGF0aW9uTGFiZWwsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25WaXNpYmlsaXR5OiBwcm9wcy5vdmVycmlkZUFubm90YXRpb25WaXNpYmlsaXR5LFxuICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBwcm9wcy5jb21wYXJpc29uT3BlcmF0b3IsXG4gICAgICB0aHJlc2hvbGQ6IHByb3BzLnRocmVzaG9sZCxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzLmRpc2FtYmlndWF0b3IsXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzID8/IFtdLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMgPz8ge30sXG4gICAgfSk7XG5cbiAgICAvLyByZXR1cm4gdGhlIGZpbmFsIHJlc3VsdFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsYXJtLFxuICAgICAgYWN0aW9uLFxuICAgICAgYWxhcm1OYW1lLFxuICAgICAgYWxhcm1OYW1lU3VmZml4LFxuICAgICAgYWxhcm1MYWJlbCxcbiAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMsXG4gICAgICBhbGFybVJ1bGVXaGVuT2s6IEFsYXJtUnVsZS5mcm9tQWxhcm0oYWxhcm0sIEFsYXJtU3RhdGUuT0spLFxuICAgICAgYWxhcm1SdWxlV2hlbkFsYXJtaW5nOiBBbGFybVJ1bGUuZnJvbUFsYXJtKGFsYXJtLCBBbGFybVN0YXRlLkFMQVJNKSxcbiAgICAgIGFsYXJtUnVsZVdoZW5JbnN1ZmZpY2llbnREYXRhOiBBbGFybVJ1bGUuZnJvbUFsYXJtKFxuICAgICAgICBhbGFybSxcbiAgICAgICAgQWxhcm1TdGF0ZS5JTlNVRkZJQ0lFTlRfREFUQVxuICAgICAgKSxcbiAgICAgIGRlZHVwZVN0cmluZyxcbiAgICAgIGFubm90YXRpb24sXG4gICAgICBkaXNhbWJpZ3VhdG9yOiBwcm9wcy5kaXNhbWJpZ3VhdG9yLFxuICAgIH07XG4gIH1cblxuICBhZGRDb21wb3NpdGVBbGFybShcbiAgICBhbGFybXM6IEFsYXJtV2l0aEFubm90YXRpb25bXSxcbiAgICBwcm9wczogQWRkQ29tcG9zaXRlQWxhcm1Qcm9wc1xuICApOiBDb21wb3NpdGVBbGFybSB7XG4gICAgY29uc3QgYWN0aW9uc0VuYWJsZWQgPSB0aGlzLmRldGVybWluZUFjdGlvbnNFbmFibGVkKFxuICAgICAgcHJvcHM/LmFjdGlvbnNFbmFibGVkLFxuICAgICAgcHJvcHM/LmRpc2FtYmlndWF0b3JcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9XG4gICAgICBwcm9wcy5hY3Rpb25PdmVycmlkZSA/PyB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuYWN0aW9uID8/IG5vb3BBY3Rpb24oKTtcbiAgICBjb25zdCBuYW1pbmdJbnB1dCA9IHsgYWxhcm1OYW1lU3VmZml4OiBcIkNvbXBvc2l0ZVwiLCAuLi5wcm9wcyB9O1xuICAgIGNvbnN0IGFsYXJtTmFtZSA9IHRoaXMuYWxhcm1OYW1pbmdTdHJhdGVneS5nZXROYW1lKG5hbWluZ0lucHV0KTtcbiAgICBjb25zdCBhbGFybURlc2NyaXB0aW9uID0gdGhpcy5nZW5lcmF0ZURlc2NyaXB0aW9uKFxuICAgICAgcHJvcHM/LmFsYXJtRGVzY3JpcHRpb24gPz8gXCJDb21wb3NpdGUgYWxhcm1cIixcbiAgICAgIHByb3BzPy5hbGFybURlc2NyaXB0aW9uT3ZlcnJpZGUsXG4gICAgICBwcm9wcz8ucnVuYm9va0xpbmssXG4gICAgICBwcm9wcz8uZG9jdW1lbnRhdGlvbkxpbmtcbiAgICApO1xuICAgIGNvbnN0IGRlZHVwZVN0cmluZyA9IHRoaXMuYWxhcm1OYW1pbmdTdHJhdGVneS5nZXREZWR1cGVTdHJpbmcobmFtaW5nSW5wdXQpO1xuICAgIGNvbnN0IGFsYXJtUnVsZSA9IHRoaXMuZGV0ZXJtaW5lQ29tcG9zaXRlQWxhcm1SdWxlKGFsYXJtcywgcHJvcHMpO1xuXG4gICAgY29uc3QgYWxhcm0gPSBuZXcgQ29tcG9zaXRlQWxhcm0odGhpcy5hbGFybVNjb3BlLCBhbGFybU5hbWUsIHtcbiAgICAgIGNvbXBvc2l0ZUFsYXJtTmFtZTogYWxhcm1OYW1lLFxuICAgICAgYWxhcm1EZXNjcmlwdGlvbixcbiAgICAgIGFsYXJtUnVsZSxcbiAgICAgIGFjdGlvbnNFbmFibGVkLFxuICAgIH0pO1xuXG4gICAgYWN0aW9uLmFkZEFsYXJtQWN0aW9ucyh7XG4gICAgICBhbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGRlZHVwZVN0cmluZyxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzPy5kaXNhbWJpZ3VhdG9yLFxuICAgICAgY3VzdG9tVGFnczogcHJvcHM/LmN1c3RvbVRhZ3MsXG4gICAgICBjdXN0b21QYXJhbXM6IHByb3BzPy5jdXN0b21QYXJhbXMsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gYWxhcm07XG4gIH1cblxuICBwcm90ZWN0ZWQgZGV0ZXJtaW5lQ29tcG9zaXRlQWxhcm1SdWxlKFxuICAgIGFsYXJtczogQWxhcm1XaXRoQW5ub3RhdGlvbltdLFxuICAgIHByb3BzOiBBZGRDb21wb3NpdGVBbGFybVByb3BzXG4gICk6IElBbGFybVJ1bGUge1xuICAgIGNvbnN0IGFsYXJtUnVsZXMgPSBhbGFybXMubWFwKChhbGFybSkgPT4gYWxhcm0uYWxhcm1SdWxlV2hlbkFsYXJtaW5nKTtcbiAgICBjb25zdCBvcGVyYXRvciA9IHByb3BzLmNvbXBvc2l0ZU9wZXJhdG9yID8/IENvbXBvc2l0ZUFsYXJtT3BlcmF0b3IuT1I7XG4gICAgc3dpdGNoIChvcGVyYXRvcikge1xuICAgICAgY2FzZSBDb21wb3NpdGVBbGFybU9wZXJhdG9yLkFORDpcbiAgICAgICAgcmV0dXJuIEFsYXJtUnVsZS5hbGxPZiguLi5hbGFybVJ1bGVzKTtcbiAgICAgIGNhc2UgQ29tcG9zaXRlQWxhcm1PcGVyYXRvci5PUjpcbiAgICAgICAgcmV0dXJuIEFsYXJtUnVsZS5hbnlPZiguLi5hbGFybVJ1bGVzKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgY29tcG9zaXRlIGFsYXJtIG9wZXJhdG9yOiAke29wZXJhdG9yfWApO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBkZXRlcm1pbmVBY3Rpb25zRW5hYmxlZChcbiAgICBhY3Rpb25zRW5hYmxlZD86IGJvb2xlYW4sXG4gICAgZGlzYW1iaWd1YXRvcj86IHN0cmluZ1xuICApOiBib29sZWFuIHtcbiAgICBpZiAoYWN0aW9uc0VuYWJsZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gYWxhcm0tc3BlY2lmaWMgb3ZlcnJpZGUgdG8gdHJ1ZSBvciBmYWxzZVxuICAgICAgcmV0dXJuIGFjdGlvbnNFbmFibGVkO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hY3Rpb25zRW5hYmxlZCA9PT0gXCJib29sZWFuXCIpIHtcbiAgICAgIC8vIGdsb2JhbCBkZWZhdWx0czogYm9vbGVhbiB2YWx1ZVxuICAgICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hY3Rpb25zRW5hYmxlZDtcbiAgICB9XG4gICAgaWYgKGRpc2FtYmlndWF0b3IpIHtcbiAgICAgIC8vIGdsb2JhbCBkZWZhdWx0czogZGlzYW1iaWd1YXRvciBiYXNlZCB2YWx1ZVxuICAgICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hY3Rpb25zRW5hYmxlZFtkaXNhbWJpZ3VhdG9yXSA/PyBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGRldGVybWluZUFjdGlvbihcbiAgICBkaXNhbWJpZ3VhdG9yPzogc3RyaW5nLFxuICAgIGFjdGlvbk92ZXJyaWRlPzogSUFsYXJtQWN0aW9uU3RyYXRlZ3lcbiAgKTogSUFsYXJtQWN0aW9uU3RyYXRlZ3kge1xuICAgIC8vIEV4cGxpY2l0IG92ZXJyaWRlXG4gICAgaWYgKGFjdGlvbk92ZXJyaWRlKSB7XG4gICAgICByZXR1cm4gYWN0aW9uT3ZlcnJpZGU7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBieSBkaXNhbWJpdWdhdG9yXG4gICAgaWYgKFxuICAgICAgZGlzYW1iaWd1YXRvciAmJlxuICAgICAgdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmRpc2FtYmlndWF0b3JBY3Rpb24/LltkaXNhbWJpZ3VhdG9yXVxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5kaXNhbWJpZ3VhdG9yQWN0aW9uW2Rpc2FtYmlndWF0b3JdO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgZ2xvYmFsIGFjdGlvblxuICAgIHJldHVybiB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuYWN0aW9uID8/IG5vb3BBY3Rpb24oKTtcbiAgfVxuXG4gIGdldCBzaG91bGRVc2VEZWZhdWx0RGVkdXBlRm9yRXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy51c2VEZWZhdWx0RGVkdXBlRm9yRXJyb3IgPz8gdHJ1ZTtcbiAgfVxuXG4gIGdldCBzaG91bGRVc2VEZWZhdWx0RGVkdXBlRm9yTGF0ZW5jeSgpIHtcbiAgICByZXR1cm4gdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLnVzZURlZmF1bHREZWR1cGVGb3JMYXRlbmN5ID8/IHRydWU7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2VuZXJhdGVEZXNjcmlwdGlvbihcbiAgICBhbGFybURlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgYWxhcm1EZXNjcmlwdGlvbk92ZXJyaWRlPzogc3RyaW5nLFxuICAgIHJ1bmJvb2tMaW5rT3ZlcnJpZGU/OiBzdHJpbmcsXG4gICAgZG9jdW1lbnRhdGlvbkxpbmtPdmVycmlkZT86IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBwYXJ0cyA9IFthbGFybURlc2NyaXB0aW9uT3ZlcnJpZGUgPz8gYWxhcm1EZXNjcmlwdGlvbl07XG5cbiAgICBjb25zdCBydW5ib29rTGluayA9XG4gICAgICBydW5ib29rTGlua092ZXJyaWRlID8/IHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5ydW5ib29rTGluaztcbiAgICBjb25zdCBkb2N1bWVudGF0aW9uTGluayA9XG4gICAgICBkb2N1bWVudGF0aW9uTGlua092ZXJyaWRlID8/IHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5kb2N1bWVudGF0aW9uTGluaztcblxuICAgIGlmIChydW5ib29rTGluaykge1xuICAgICAgcGFydHMucHVzaChgUnVuYm9vazogJHtydW5ib29rTGlua31gKTtcbiAgICB9XG5cbiAgICBpZiAoZG9jdW1lbnRhdGlvbkxpbmspIHtcbiAgICAgIHBhcnRzLnB1c2goYERvY3VtZW50YXRpb246ICR7ZG9jdW1lbnRhdGlvbkxpbmt9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuam9pbkRlc2NyaXB0aW9uUGFydHMoLi4ucGFydHMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGpvaW5EZXNjcmlwdGlvblBhcnRzKC4uLnBhcnRzOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiBwYXJ0cy5qb2luKFwiIFxcclxcblwiKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjcmVhdGVBbm5vdGF0aW9uKHByb3BzOiBBbGFybUFubm90YXRpb25TdHJhdGVneVByb3BzKSB7XG4gICAgY29uc3Qgc3RyYXRlZ3kgPVxuICAgICAgdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmFubm90YXRpb25TdHJhdGVneSA/P1xuICAgICAgbmV3IERlZmF1bHRBbGFybUFubm90YXRpb25TdHJhdGVneSgpO1xuICAgIHJldHVybiBzdHJhdGVneS5jcmVhdGVBbm5vdGF0aW9uKHByb3BzKTtcbiAgfVxufVxuIl19