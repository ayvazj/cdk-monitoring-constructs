"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.RdsClusterMetricFactory = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const common_1 = require("../../common");
const RdsNamespace = "AWS/RDS";
class RdsClusterMetricFactory {
    constructor(metricFactory, props) {
        this.metricFactory = metricFactory;
        this.cluster = props.cluster;
        this.clusterIdentifier =
            RdsClusterMetricFactory.resolveDbClusterIdentifier(props);
        this.dimensionsMap = { DBClusterIdentifier: this.clusterIdentifier };
    }
    static resolveDbClusterIdentifier(props) {
        if (props.clusterIdentifier !== undefined && props.cluster === undefined) {
            return props.clusterIdentifier;
        }
        else if (props.clusterIdentifier === undefined &&
            props.cluster !== undefined) {
            return props.cluster.clusterIdentifier;
        }
        else if (props.cluster !== undefined && props.cluster !== undefined) {
            throw Error("Only one of `clusterIdentifier` and `cluster` is supported");
        }
        else {
            throw Error("At least one of `clusterIdentifier` or `cluster` is required");
        }
    }
    isServerlessCluster(obj) {
        return obj.clusterArn !== undefined;
    }
    metricTotalConnectionCount() {
        return this.metric("DatabaseConnections", common_1.MetricStatistic.AVERAGE, "Connections");
    }
    metricFreeStorageInBytes() {
        return this.metric("FreeLocalStorage", common_1.MetricStatistic.MIN, "Free");
    }
    metricUsedStorageInBytes() {
        return this.metric("VolumeBytesUsed", common_1.MetricStatistic.MAX, "Used");
    }
    metricDiskSpaceUsageInPercent() {
        const used = this.metricUsedStorageInBytes();
        const free = this.metricFreeStorageInBytes();
        return this.metricFactory.createMetricMath("100 * (used/(used+free))", { used, free }, "Disk Usage");
    }
    metricAverageCpuUsageInPercent() {
        return this.metric("CPUUtilization", common_1.MetricStatistic.AVERAGE, "CPU Usage");
    }
    metricSelectLatencyP90InMillis() {
        return this.metric("SelectLatency", common_1.MetricStatistic.P90, "Select");
    }
    metricInsertLatencyP90InMillis() {
        return this.metric("InsertLatency", common_1.MetricStatistic.P90, "Insert");
    }
    metricUpdateLatencyP90InMillis() {
        return this.metric("UpdateLatency", common_1.MetricStatistic.P90, "Update");
    }
    metricDeleteLatencyP90InMillis() {
        return this.metric("DeleteLatency", common_1.MetricStatistic.P90, "Delete");
    }
    metricCommitLatencyP90InMillis() {
        return this.metric("CommitLatency", common_1.MetricStatistic.P90, "Commit");
    }
    metricServerlessDatabaseCapacity() {
        if (!this.isServerlessCluster(this.cluster)) {
            throw Error("Cluster is not of type `ServerlessCluster`. Metric is not applicable");
        }
        return this.metric("ServerlessDatabaseCapacity", common_1.MetricStatistic.AVERAGE, "Serverless Database Capacity");
    }
    metric(metricName, statistic, label) {
        return this.metricFactory.createMetric(metricName, statistic, label, this.dimensionsMap, undefined, RdsNamespace);
    }
}
exports.RdsClusterMetricFactory = RdsClusterMetricFactory;
_a = JSII_RTTI_SYMBOL_1;
RdsClusterMetricFactory[_a] = { fqn: "cdk-monitoring-constructs.RdsClusterMetricFactory", version: "0.0.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmRzQ2x1c3Rlck1ldHJpY0ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJSZHNDbHVzdGVyTWV0cmljRmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUdBLHlDQUE4RDtBQUU5RCxNQUFNLFlBQVksR0FBRyxTQUFTLENBQUM7QUFjL0IsTUFBYSx1QkFBdUI7SUFNbEMsWUFDRSxhQUE0QixFQUM1QixLQUFtQztRQUVuQyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDN0IsSUFBSSxDQUFDLGlCQUFpQjtZQUNwQix1QkFBdUIsQ0FBQywwQkFBMEIsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7SUFDdkUsQ0FBQztJQUVPLE1BQU0sQ0FBQywwQkFBMEIsQ0FDdkMsS0FBbUM7UUFFbkMsSUFBSSxLQUFLLENBQUMsaUJBQWlCLEtBQUssU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssU0FBUyxFQUFFO1lBQ3hFLE9BQU8sS0FBSyxDQUFDLGlCQUFpQixDQUFDO1NBQ2hDO2FBQU0sSUFDTCxLQUFLLENBQUMsaUJBQWlCLEtBQUssU0FBUztZQUNyQyxLQUFLLENBQUMsT0FBTyxLQUFLLFNBQVMsRUFDM0I7WUFDQSxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7U0FDeEM7YUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssU0FBUyxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssU0FBUyxFQUFFO1lBQ3JFLE1BQU0sS0FBSyxDQUFDLDREQUE0RCxDQUFDLENBQUM7U0FDM0U7YUFBTTtZQUNMLE1BQU0sS0FBSyxDQUNULDhEQUE4RCxDQUMvRCxDQUFDO1NBQ0g7SUFDSCxDQUFDO0lBRU8sbUJBQW1CLENBQUMsR0FBUTtRQUNsQyxPQUFRLEdBQVcsQ0FBQyxVQUFVLEtBQUssU0FBUyxDQUFDO0lBQy9DLENBQUM7SUFFRCwwQkFBMEI7UUFDeEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUNoQixxQkFBcUIsRUFDckIsd0JBQWUsQ0FBQyxPQUFPLEVBQ3ZCLGFBQWEsQ0FDZCxDQUFDO0lBQ0osQ0FBQztJQUVELHdCQUF3QjtRQUN0QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsd0JBQWUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELHdCQUF3QjtRQUN0QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsd0JBQWUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELDZCQUE2QjtRQUMzQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUM3QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUM3QyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQ3hDLDBCQUEwQixFQUMxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFDZCxZQUFZLENBQ2IsQ0FBQztJQUNKLENBQUM7SUFFRCw4QkFBOEI7UUFDNUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLHdCQUFlLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFFRCw4QkFBOEI7UUFDNUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSx3QkFBZSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQsOEJBQThCO1FBQzVCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsd0JBQWUsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELDhCQUE4QjtRQUM1QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLHdCQUFlLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3JFLENBQUM7SUFFRCw4QkFBOEI7UUFDNUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRSx3QkFBZSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNyRSxDQUFDO0lBRUQsOEJBQThCO1FBQzVCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsd0JBQWUsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELGdDQUFnQztRQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQyxNQUFNLEtBQUssQ0FDVCxzRUFBc0UsQ0FDdkUsQ0FBQztTQUNIO1FBQ0QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUNoQiw0QkFBNEIsRUFDNUIsd0JBQWUsQ0FBQyxPQUFPLEVBQ3ZCLDhCQUE4QixDQUMvQixDQUFDO0lBQ0osQ0FBQztJQUVPLE1BQU0sQ0FDWixVQUFrQixFQUNsQixTQUEwQixFQUMxQixLQUFhO1FBRWIsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FDcEMsVUFBVSxFQUNWLFNBQVMsRUFDVCxLQUFLLEVBQ0wsSUFBSSxDQUFDLGFBQWEsRUFDbEIsU0FBUyxFQUNULFlBQVksQ0FDYixDQUFDO0lBQ0osQ0FBQzs7QUFwSEgsMERBcUhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGltZW5zaW9uc01hcCB9IGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaFwiO1xuaW1wb3J0IHsgSURhdGFiYXNlQ2x1c3RlciwgU2VydmVybGVzc0NsdXN0ZXIgfSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLXJkc1wiO1xuXG5pbXBvcnQgeyBNZXRyaWNGYWN0b3J5LCBNZXRyaWNTdGF0aXN0aWMgfSBmcm9tIFwiLi4vLi4vY29tbW9uXCI7XG5cbmNvbnN0IFJkc05hbWVzcGFjZSA9IFwiQVdTL1JEU1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJkc0NsdXN0ZXJNZXRyaWNGYWN0b3J5UHJvcHMge1xuICAvKipcbiAgICogZGF0YWJhc2UgY2x1c3RlciBpZGVudGlmaWVyIChlaXRoZXIgdGhpcyBvciBgY2x1c3RlcmAgbmVlZCB0byBiZSBzcGVjaWZpZWQpXG4gICAqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgYGNsdXN0ZXJgIGluc3RlYWRcbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXJJZGVudGlmaWVyPzogc3RyaW5nO1xuICAvKipcbiAgICogZGF0YWJhc2UgY2x1c3RlciAoZWl0aGVyIHRoaXMgb3IgYGNsdXN0ZXJJZGVudGlmaWVyYCBuZWVkIHRvIGJlIHNwZWNpZmllZClcbiAgICovXG4gIHJlYWRvbmx5IGNsdXN0ZXI/OiBJRGF0YWJhc2VDbHVzdGVyIHwgU2VydmVybGVzc0NsdXN0ZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBSZHNDbHVzdGVyTWV0cmljRmFjdG9yeSB7XG4gIHJlYWRvbmx5IGNsdXN0ZXJJZGVudGlmaWVyOiBzdHJpbmc7XG4gIHJlYWRvbmx5IGNsdXN0ZXI/OiBJRGF0YWJhc2VDbHVzdGVyIHwgU2VydmVybGVzc0NsdXN0ZXI7XG4gIHByb3RlY3RlZCByZWFkb25seSBtZXRyaWNGYWN0b3J5OiBNZXRyaWNGYWN0b3J5O1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGltZW5zaW9uc01hcDogRGltZW5zaW9uc01hcDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBtZXRyaWNGYWN0b3J5OiBNZXRyaWNGYWN0b3J5LFxuICAgIHByb3BzOiBSZHNDbHVzdGVyTWV0cmljRmFjdG9yeVByb3BzXG4gICkge1xuICAgIHRoaXMubWV0cmljRmFjdG9yeSA9IG1ldHJpY0ZhY3Rvcnk7XG4gICAgdGhpcy5jbHVzdGVyID0gcHJvcHMuY2x1c3RlcjtcbiAgICB0aGlzLmNsdXN0ZXJJZGVudGlmaWVyID1cbiAgICAgIFJkc0NsdXN0ZXJNZXRyaWNGYWN0b3J5LnJlc29sdmVEYkNsdXN0ZXJJZGVudGlmaWVyKHByb3BzKTtcbiAgICB0aGlzLmRpbWVuc2lvbnNNYXAgPSB7IERCQ2x1c3RlcklkZW50aWZpZXI6IHRoaXMuY2x1c3RlcklkZW50aWZpZXIgfTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHJlc29sdmVEYkNsdXN0ZXJJZGVudGlmaWVyKFxuICAgIHByb3BzOiBSZHNDbHVzdGVyTWV0cmljRmFjdG9yeVByb3BzXG4gICk6IHN0cmluZyB7XG4gICAgaWYgKHByb3BzLmNsdXN0ZXJJZGVudGlmaWVyICE9PSB1bmRlZmluZWQgJiYgcHJvcHMuY2x1c3RlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gcHJvcHMuY2x1c3RlcklkZW50aWZpZXI7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHByb3BzLmNsdXN0ZXJJZGVudGlmaWVyID09PSB1bmRlZmluZWQgJiZcbiAgICAgIHByb3BzLmNsdXN0ZXIgIT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgcmV0dXJuIHByb3BzLmNsdXN0ZXIuY2x1c3RlcklkZW50aWZpZXI7XG4gICAgfSBlbHNlIGlmIChwcm9wcy5jbHVzdGVyICE9PSB1bmRlZmluZWQgJiYgcHJvcHMuY2x1c3RlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBFcnJvcihcIk9ubHkgb25lIG9mIGBjbHVzdGVySWRlbnRpZmllcmAgYW5kIGBjbHVzdGVyYCBpcyBzdXBwb3J0ZWRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBcIkF0IGxlYXN0IG9uZSBvZiBgY2x1c3RlcklkZW50aWZpZXJgIG9yIGBjbHVzdGVyYCBpcyByZXF1aXJlZFwiXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNTZXJ2ZXJsZXNzQ2x1c3RlcihvYmo6IGFueSk6IG9iaiBpcyBTZXJ2ZXJsZXNzQ2x1c3RlciB7XG4gICAgcmV0dXJuIChvYmogYXMgYW55KS5jbHVzdGVyQXJuICE9PSB1bmRlZmluZWQ7XG4gIH1cblxuICBtZXRyaWNUb3RhbENvbm5lY3Rpb25Db3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXG4gICAgICBcIkRhdGFiYXNlQ29ubmVjdGlvbnNcIixcbiAgICAgIE1ldHJpY1N0YXRpc3RpYy5BVkVSQUdFLFxuICAgICAgXCJDb25uZWN0aW9uc1wiXG4gICAgKTtcbiAgfVxuXG4gIG1ldHJpY0ZyZWVTdG9yYWdlSW5CeXRlcygpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXCJGcmVlTG9jYWxTdG9yYWdlXCIsIE1ldHJpY1N0YXRpc3RpYy5NSU4sIFwiRnJlZVwiKTtcbiAgfVxuXG4gIG1ldHJpY1VzZWRTdG9yYWdlSW5CeXRlcygpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXCJWb2x1bWVCeXRlc1VzZWRcIiwgTWV0cmljU3RhdGlzdGljLk1BWCwgXCJVc2VkXCIpO1xuICB9XG5cbiAgbWV0cmljRGlza1NwYWNlVXNhZ2VJblBlcmNlbnQoKSB7XG4gICAgY29uc3QgdXNlZCA9IHRoaXMubWV0cmljVXNlZFN0b3JhZ2VJbkJ5dGVzKCk7XG4gICAgY29uc3QgZnJlZSA9IHRoaXMubWV0cmljRnJlZVN0b3JhZ2VJbkJ5dGVzKCk7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljRmFjdG9yeS5jcmVhdGVNZXRyaWNNYXRoKFxuICAgICAgXCIxMDAgKiAodXNlZC8odXNlZCtmcmVlKSlcIixcbiAgICAgIHsgdXNlZCwgZnJlZSB9LFxuICAgICAgXCJEaXNrIFVzYWdlXCJcbiAgICApO1xuICB9XG5cbiAgbWV0cmljQXZlcmFnZUNwdVVzYWdlSW5QZXJjZW50KCkge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYyhcIkNQVVV0aWxpemF0aW9uXCIsIE1ldHJpY1N0YXRpc3RpYy5BVkVSQUdFLCBcIkNQVSBVc2FnZVwiKTtcbiAgfVxuXG4gIG1ldHJpY1NlbGVjdExhdGVuY3lQOTBJbk1pbGxpcygpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXCJTZWxlY3RMYXRlbmN5XCIsIE1ldHJpY1N0YXRpc3RpYy5QOTAsIFwiU2VsZWN0XCIpO1xuICB9XG5cbiAgbWV0cmljSW5zZXJ0TGF0ZW5jeVA5MEluTWlsbGlzKCkge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYyhcIkluc2VydExhdGVuY3lcIiwgTWV0cmljU3RhdGlzdGljLlA5MCwgXCJJbnNlcnRcIik7XG4gIH1cblxuICBtZXRyaWNVcGRhdGVMYXRlbmN5UDkwSW5NaWxsaXMoKSB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljKFwiVXBkYXRlTGF0ZW5jeVwiLCBNZXRyaWNTdGF0aXN0aWMuUDkwLCBcIlVwZGF0ZVwiKTtcbiAgfVxuXG4gIG1ldHJpY0RlbGV0ZUxhdGVuY3lQOTBJbk1pbGxpcygpIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXCJEZWxldGVMYXRlbmN5XCIsIE1ldHJpY1N0YXRpc3RpYy5QOTAsIFwiRGVsZXRlXCIpO1xuICB9XG5cbiAgbWV0cmljQ29tbWl0TGF0ZW5jeVA5MEluTWlsbGlzKCkge1xuICAgIHJldHVybiB0aGlzLm1ldHJpYyhcIkNvbW1pdExhdGVuY3lcIiwgTWV0cmljU3RhdGlzdGljLlA5MCwgXCJDb21taXRcIik7XG4gIH1cblxuICBtZXRyaWNTZXJ2ZXJsZXNzRGF0YWJhc2VDYXBhY2l0eSgpIHtcbiAgICBpZiAoIXRoaXMuaXNTZXJ2ZXJsZXNzQ2x1c3Rlcih0aGlzLmNsdXN0ZXIpKSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgXCJDbHVzdGVyIGlzIG5vdCBvZiB0eXBlIGBTZXJ2ZXJsZXNzQ2x1c3RlcmAuIE1ldHJpYyBpcyBub3QgYXBwbGljYWJsZVwiXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5tZXRyaWMoXG4gICAgICBcIlNlcnZlcmxlc3NEYXRhYmFzZUNhcGFjaXR5XCIsXG4gICAgICBNZXRyaWNTdGF0aXN0aWMuQVZFUkFHRSxcbiAgICAgIFwiU2VydmVybGVzcyBEYXRhYmFzZSBDYXBhY2l0eVwiXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgbWV0cmljKFxuICAgIG1ldHJpY05hbWU6IHN0cmluZyxcbiAgICBzdGF0aXN0aWM6IE1ldHJpY1N0YXRpc3RpYyxcbiAgICBsYWJlbDogc3RyaW5nXG4gICkge1xuICAgIHJldHVybiB0aGlzLm1ldHJpY0ZhY3RvcnkuY3JlYXRlTWV0cmljKFxuICAgICAgbWV0cmljTmFtZSxcbiAgICAgIHN0YXRpc3RpYyxcbiAgICAgIGxhYmVsLFxuICAgICAgdGhpcy5kaW1lbnNpb25zTWFwLFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgUmRzTmFtZXNwYWNlXG4gICAgKTtcbiAgfVxufVxuIl19